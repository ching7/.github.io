(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{357:function(s,a,t){"use strict";t.r(a);var n=t(44),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"fastdfs-分布式文件系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fastdfs-分布式文件系统"}},[s._v("#")]),s._v(" FastDFS(分布式文件系统)")]),s._v(" "),t("h2",{attrs:{id:"_1-什么是fastdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是fastdfs"}},[s._v("#")]),s._v(" 1  什么是FastDFS")]),s._v(" "),t("h3",{attrs:{id:"_1-1-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-简介"}},[s._v("#")]),s._v(" 1.1  简介")]),s._v(" "),t("p",[t("code",[s._v("FastDFS")]),s._v("是用c语言编写的一款开源的分布式文件系统，它是由淘宝资深架构师余庆编写并开源。"),t("code",[s._v("FastDFS")]),s._v("专为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用"),t("code",[s._v("FastDFS")]),s._v("很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。")]),s._v(" "),t("p",[s._v("为什么要使用"),t("code",[s._v("FastDFS")]),s._v("呢？")]),s._v(" "),t("p",[s._v("已有的的"),t("code",[s._v("NFS")]),s._v("、"),t("code",[s._v("GFS")]),s._v("都是通用的分布式文件系统，通用的分布式文件系统的优点的是开发体验好，但是系统复杂性高、性能一般，而专用的分布式文件系统虽然开发体验性差，但是系统复杂性低并且性能高。")]),s._v(" "),t("p",[t("code",[s._v("FastDFS")]),s._v("非常适合存储图片等那些小文件，"),t("code",[s._v("FastDFS")]),s._v("不对文件进行分块，所以它就没有分块合并的开销，"),t("code",[s._v("FastDFS")]),s._v("网络通信采用"),t("code",[s._v("socket")]),s._v("，通信速度很快。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-工作原理"}},[s._v("#")]),s._v(" 1.2  工作原理")]),s._v(" "),t("h4",{attrs:{id:"_1-2-1-fastdsf架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-fastdsf架构"}},[s._v("#")]),s._v(" 1.2.1 "),t("code",[s._v("FastDSF")]),s._v("架构")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/fastdfs.jpg",alt:""}})]),s._v(" "),t("p",[t("code",[s._v("FastDFS")]),s._v("架构包括 "),t("code",[s._v("Tracker server")]),s._v("和"),t("code",[s._v("Storag eserver")]),s._v("。客户端请求"),t("code",[s._v("Tracker server")]),s._v("进行文件上传、下载，通过"),t("code",[s._v("Tracker server")]),s._v("调度最终由"),t("code",[s._v("Storage server")]),s._v("完成文件上传和下载。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Tracker")]),s._v(" "),t("p",[t("code",[s._v("Tracker Server")]),s._v("作用是负载均衡和调度，通过"),t("code",[s._v("Tracker server")]),s._v("在文件上传时可以根据一些策略找到"),t("code",[s._v("Storage server")]),s._v("提供文件上传服务。可以将"),t("code",[s._v("Tracker")]),s._v("称为追踪服务器或调度服务器。")]),s._v(" "),t("p",[t("code",[s._v("Tracker server")]),s._v("更像一个管理指挥员，管理"),t("code",[s._v("Storage server")]),s._v("，协调客户机将文件上传到"),t("code",[s._v("Storage Server")])]),s._v(" "),t("p",[t("code",[s._v("FastDFS")]),s._v("集群中的"),t("code",[s._v("Tracker server")]),s._v("可以有多台，"),t("code",[s._v("Tracker server")]),s._v("之间是相互平等关系同时提供服务，"),t("code",[s._v("Tracker server")]),s._v("不存在单点故障。客户端请求"),t("code",[s._v("racker server")]),s._v("采用轮询方式，如果请求的"),t("code",[s._v("tracker")]),s._v("无法提供服务则换另一个"),t("code",[s._v("tracker")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("Storage")]),s._v(" "),t("p",[t("code",[s._v("Storage Server")]),s._v("作用是文件存储，客户端上传的文件最终存储在"),t("code",[s._v("Storage")]),s._v("服务器上，"),t("code",[s._v("Storage server")]),s._v("没有实现自己的文件系统而是使用操作系统的文件系统来管理文件。可以将"),t("code",[s._v("storage")]),s._v("称为存储服务器。")]),s._v(" "),t("p",[t("code",[s._v("Storage")]),s._v("集群采用了分组存储方式。"),t("code",[s._v("storage")]),s._v("集群由一个或多个组构成，集群存储总容量为集群中所有组的存储容量之和。一个组由一台或多台存储服务器组成，组内的"),t("code",[s._v("Storage server")]),s._v("之间是平等关系，不同组的"),t("code",[s._v("Storage server")]),s._v("之间不会相互通信，同组内的"),t("code",[s._v("Storage server")]),s._v("之间会相互连接进行文件同步，从而保证同组内每个"),t("code",[s._v("storage")]),s._v("上的文件完\n全一致的。一个组的存储容量为该组内存储服务器容量最小的那个，由此可见组内存储服务器的软硬件配置最好是一致的。")]),s._v(" "),t("p",[s._v("采用分组存储方式的好处是灵活、可控性较强。比如上传文件时，可以由客户端直接指定上传到的组也可以由"),t("code",[s._v("tracker")]),s._v("进行调度选择。一个分组的存储服务器访问压力较大时，可以在该组增加存储服务器来扩充服务能力（纵向扩容）。当系统容量不足时，可以增加组来扩充存储容量（横向扩容）。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("Storage")]),s._v("状态收集")]),s._v(" "),t("p",[t("code",[s._v("Storage server")]),s._v("会连接集群中所有的"),t("code",[s._v("Tracker server")]),s._v("，定时向他们报告自己的状态，包括磁盘剩余空间、文件同步状况、文件上传下载次数等统计信息。")])])]),s._v(" "),t("h4",{attrs:{id:"_1-2-2-文件上传流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-文件上传流程"}},[s._v("#")]),s._v(" 1.2.2 文件上传流程")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/fastdfs1.jpg",alt:"fastdfs上传流程"}})]),s._v(" "),t("p",[s._v("客户端上传文件后存储服务器将文件ID返回给客户端，此文件ID用于以后访问该文件的索引信息。文件索引信息包括：组名，虚拟磁盘路径，数据两级目录，文件名。")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("group1/M00/00/00/wKjRgF3PPvOAOF7HAAFl33KnvNs832.jpg\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("组名：文件上传后所在的"),t("code",[s._v("storage")]),s._v("组名称，在文件上传成功后有"),t("code",[s._v("storage")]),s._v("服务器返回，需要客户端自行保存。")]),s._v(" "),t("li",[s._v("虚拟磁盘路径："),t("code",[s._v("storage")]),s._v("配置的虚拟路径，与磁盘选项"),t("code",[s._v("store_path*")]),s._v("对应。如果配置了"),t("code",[s._v("store_path0")]),s._v("则是"),t("code",[s._v("M00")]),s._v("，如果配置了"),t("code",[s._v("store_path1")]),s._v("则是"),t("code",[s._v("M01")]),s._v("，以此类推。")]),s._v(" "),t("li",[s._v("数据两级目录："),t("code",[s._v("storage")]),s._v("服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据文件")]),s._v(" "),t("li",[s._v("文件名：与文件上传时不同。是由存储服务器根据特定信息生成，文件名包含：源存储服务器IP地址、文件创\n建时间戳、文件大小、随机数和文件拓展名等信息。")])]),s._v(" "),t("h4",{attrs:{id:"_1-2-3-文件下载流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-文件下载流程"}},[s._v("#")]),s._v(" 1.2.3 文件下载流程")]),s._v(" "),t("p",[s._v("tracker根据请求的文件路径即文件ID 来快速定义文件。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/fastdfs2.jpg",alt:"fastdfs下载流程"}})]),s._v(" "),t("p",[s._v("比如请求下边的文件：")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("group1/M00/00/00/wKjRgF3PPvOAOF7HAAFl33KnvNs832.jpg\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("通过组名"),t("code",[s._v("tracker")]),s._v("能够很快的定位到客户端需要访问的存储服务器组是"),t("code",[s._v("group1")]),s._v("，并选择合适的存储服务器提供客户端访问。")]),s._v(" "),t("li",[s._v("存储服务器根据“文件存储虚拟磁盘路径”和“数据文件两级目录”可以很快定位到文件所在目录，并根据文件名找到\n客户端需要访问的文件。")])]),s._v(" "),t("h2",{attrs:{id:"_2-fastdfs入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-fastdfs入门"}},[s._v("#")]),s._v(" 2 FastDFS入门")]),s._v(" "),t("h3",{attrs:{id:"_2-1-fastdfs安装配置-tracker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-fastdfs安装配置-tracker"}},[s._v("#")]),s._v(" 2.1 FastDFS安装配置(tracker)")]),s._v(" "),t("p",[s._v("注：本次之安装一台tracker、storage,且都在同一台机器上、方便调试。有兴趣的可以拓展成分布式")]),s._v(" "),t("h4",{attrs:{id:"_2-1-1-安装条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-安装条件"}},[s._v("#")]),s._v(" 2.1.1 安装条件")]),s._v(" "),t("ul",[t("li",[s._v("需要一台"),t("code",[s._v("CentOS7")]),s._v("虚拟机")]),s._v(" "),t("li",[s._v("下载"),t("code",[s._v("FastDFS")]),s._v("安装包，地址：https://github.com/happyfish100/FastDFS ，本文档使用"),t("code",[s._v("FastDFS_v5.05.tar.gz")])])]),s._v(" "),t("h4",{attrs:{id:"_2-1-2-准备安装环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-准备安装环境"}},[s._v("#")]),s._v(" 2.1.2 准备安装环境")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("FastDFS")]),s._v("是"),t("code",[s._v("C语言")]),s._v("开发，编译依赖"),t("code",[s._v("gcc")]),s._v("环境，安装 "),t("code",[s._v("gcc")])]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("yum -y install gcc-c++\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("依赖依赖"),t("code",[s._v("libevent")]),s._v("库")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("yum -y install libevent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("libfastcommon")]),s._v("是"),t("code",[s._v("FastDFS")]),s._v("官方提供的，"),t("code",[s._v("libfastcommon")]),s._v("包含了"),t("code",[s._v("FastDFS")]),s._v("运行所需要的一些基础库。本文档使用的是"),t("code",[s._v("libfastcommonV1.0.7.tar.gz")]),s._v(",下载地址：https://github.com/happyfish100/libfastcommon/releases")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将libfastcommonV1.0.7.tar.gz拷贝至/usr/local/下")]),s._v("\ncd /usr/local\ntar -zxvf libfastcommonV1."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7")]),s._v(".tar.gz\ncd libfastcommon-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0.7")]),s._v("\n./make.sh\n./make.sh install\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("注意："),t("code",[s._v("libfastcommon")]),s._v("安装好后会自动将库文件拷贝至"),t("code",[s._v("/usr/lib64")]),s._v("下，由于"),t("code",[s._v("FastDFS")]),s._v("程序引用"),t("code",[s._v("usr/lib")]),s._v("目录所以需要将"),t("code",[s._v("/usr/lib64")]),s._v("下的库文件拷贝至/"),t("code",[s._v("usr/lib")]),s._v("下。")])]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里要根据linux 32还是64位的实际调整")]),s._v("\ncp /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"_2-1-3-安装fastdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-安装fastdfs"}},[s._v("#")]),s._v(" 2.1.3 安装FastDFS")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将FastDFS_v5.05.tar.gz拷贝至/usr/local/下")]),s._v("\n\ntar -zxvf FastDFS_v5."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v(".tar.gz\n\ncd FastDFS\n\n./make.sh\n./make.sh install\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装成功将安装目录下的conf下的文件拷贝到/etc/fdfs/下。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"_2-1-4-配置fastdfs-tracker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-配置fastdfs-tracker"}},[s._v("#")]),s._v(" 2.1.4 配置FastDFS(tracker)")]),s._v(" "),t("p",[s._v("安装成功后进入"),t("code",[s._v("/etc/fdfs")]),s._v("目录")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝一份新的tracker配置文件：")]),s._v("\ncp tracker.conf.sample tracker.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改tracker.conf")]),s._v("\nvi tracker.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# base_path=/home/yuqing/FastDFS   ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改为：（根据个人具体情况调整）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# base_path=/home/FastDFS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置http端口：")]),s._v("\nhttp.server_port="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h4",{attrs:{id:"_2-1-5-启动tracker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-启动tracker"}},[s._v("#")]),s._v(" 2.1.5 启动Tracker")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意控制台的打印信息（注意启动顺序-tracker-storage）")]),s._v("\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_2-2-fastdfs安装配置-storage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-fastdfs安装配置-storage"}},[s._v("#")]),s._v(" 2.2 FastDFS安装配置(storage)")]),s._v(" "),t("h4",{attrs:{id:"_2-2-1-安装过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-安装过程"}},[s._v("#")]),s._v(" 2.2.1 安装过程")]),s._v(" "),t("p",[s._v("同 "),t("code",[s._v("Tracker")])]),s._v(" "),t("h4",{attrs:{id:"_2-2-2-配置fastdfs-storage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-配置fastdfs-storage"}},[s._v("#")]),s._v(" 2.2.2 配置FastDFS(Storage)")]),s._v(" "),t("p",[s._v("安装成功后进入"),t("code",[s._v("/etc/fdfs")]),s._v("目录")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝一份新的storage配置文件：")]),s._v("\ncp storage.conf.sample storage.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改storage.conf")]),s._v("\nvi storage.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# group_name=group1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# base_path=/home/yuqing/FastDFS 改为：base_path=/home/FastDFS（根据个人具体情况调整）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# store_path0=/home/yuqing/FastDFS 改为：store_path0=/home/FastDFS/fdfs_storage（根据个人具体情况调整）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果有多个挂载磁盘则定义多个store_path，如下（根据个人具体情况调整）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#store_path1=.....")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#store_path2=......")]),s._v("\ntracker_server="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.101.3")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22122")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置tracker服务器:IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果有多个则配置多个tracker")]),s._v("\ntracker_server="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.101.4")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22122")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置http端口")]),s._v("\nhttp.server_port="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h4",{attrs:{id:"_2-2-3-启动storage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-启动storage"}},[s._v("#")]),s._v(" 2.2.3 启动Storage")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意控制台的打印信息（注意启动顺序-tracker-storage）")]),s._v("\n/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_2-3-测试fastdfs是否安装成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-测试fastdfs是否安装成功"}},[s._v("#")]),s._v(" 2.3 测试FastDFS是否安装成功")]),s._v(" "),t("h4",{attrs:{id:"_2-3-1-上传图片测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-上传图片测试"}},[s._v("#")]),s._v(" 2.3.1 上传图片测试")]),s._v(" "),t("p",[t("code",[s._v("FastDFS")]),s._v("安装成功可通过"),t("code",[s._v("/usr/bin/fdfs_test")]),s._v("测试上传、下载等操作。")]),s._v(" "),t("p",[s._v("修改"),t("code",[s._v("/etc/fdfs/client.conf")])]),s._v(" "),t("p",[t("code",[s._v("tracker_server")]),s._v("根据自己部署虚拟机的情况/配置")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝一份新的client配置文件：")]),s._v("\ncp client.conf.sample client.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件")]),s._v("\nvi client.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# base_path=/home/fastdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tracker_server=192.168.101.3:22122")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("使用格式：")]),s._v(" "),t("p",[t("code",[s._v("/usr/bin/fdfs_test")]),s._v("客户端配置文件地址  "),t("code",[s._v("upload")]),s._v(" 上传文件")]),s._v(" "),t("p",[s._v("比如将"),t("code",[s._v("/home")]),s._v("下的图片上传到"),t("code",[s._v("FastDFS")]),s._v("中：")]),s._v(" "),t("div",{staticClass:"language-cma line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/bin/fdfs_test /etc/fdfs/client.conf upload /home/tomcat.png\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("看到如下日志：")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("This is FastDFS client test program v5."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Copyright")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("C"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2008")]),s._v(", Happy Fish / YuQing\n\nFastDFS may be copied only under the terms of the GNU General\nPublic License V3, which may be found in the FastDFS source kit.\nPlease visit the FastDFS Home Page http://www.csource.org/ \nfor more detail.\n\n["),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("] DEBUG - base_path=/home/chenyn/fastdfs/FastDFS, connect_timeout="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(", network_timeout="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(", tracker_server_count="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", anti_steal_token="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", anti_steal_secret_key length="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", use_connection_pool="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", g_connection_pool_max_idle_time=3600s, use_storage_id="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", storage server id count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\ntracker_query_storage_store_list_without_group: \n\tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". group_name=, ip_addr="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v(", port="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23000")]),s._v("\n\ngroup_name=group1, ip_addr="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v(", port="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23000")]),s._v("\nstorage_upload_by_filename\ngroup_name=group1, remote_filename=M00/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/wKh_gF3SsRyAJg6iAABlnZYG9PM641.png\nsource ip address: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v("\nfile timestamp="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("\nfile size="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26013")]),s._v("\nfile crc32="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2517038323")]),s._v("\nexample file url: http://"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v("/group1/M00/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/wKh_gF3SsRyAJg6iAABlnZYG9PM641.png\nstorage_upload_slave_by_filename\ngroup_name=group1, remote_filename=M00/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png\nsource ip address: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v("\nfile timestamp="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v("\nfile size="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26013")]),s._v("\nfile crc32="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2517038323")]),s._v("\nexample file url: http://"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v("/group1/M00/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("p",[s._v("恭喜你成功了🙂~")]),s._v(" "),t("h4",{attrs:{id:"_2-3-2-下载图片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-下载图片"}},[s._v("#")]),s._v(" 2.3.2 下载图片")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("http://"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.127.128")]),s._v("/group1/M00/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此路径就是文件的下载路径 对应storage服务器上的")]),s._v("\n/home/chenyn/fastdfs/FastDFS/storage/data/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png文件。\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于现在还没有和nginx整合无法使用http下载。待新增")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_3-springboot整合fastdfs实现文件上传下载测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-springboot整合fastdfs实现文件上传下载测试"}},[s._v("#")]),s._v(" 3 SpringBoot整合FastDFS实现文件上传下载测试")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("javaApi")]),s._v("测试文件的上传。\n"),t("code",[s._v("java")]),s._v("版本的"),t("code",[s._v("fastdfs-client")]),s._v("地址在：https://github.com/happyfish100/fastdfs-client-java，参考此工程编写测试用\n例。")]),s._v(" "),t("h3",{attrs:{id:"_3-1-环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-环境搭建"}},[s._v("#")]),s._v(" 3.1 环境搭建")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("新建maven工程")])]),s._v(" "),t("li",[t("p",[s._v("添加依赖")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("parent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-parent"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.1.9.RELEASE"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("relativePath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- lookup parent from repository --\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("parent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("cn.itcast.javaee"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("fastdfs"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.0‐SNAPSHOT"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \t   "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-web"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-test"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("test"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("commons-io"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("commons-io"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.4"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- https://mvnrepository.com/artifact/net.oschina.zcx7878/fastdfs-client-java --\x3e")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("net.oschina.zcx7878"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("fastdfs-client-java"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.27.0.0"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\t\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("resources目录下新建配置文件"),t("code",[s._v("fastdfs-client.properties")])])])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.connect_timeout_in_seconds")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.network_timeout_in_seconds")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("30")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.charset")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("UTF‐8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.http_anti_steal_token")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.http_secret_key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("FastDFS1234567890")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.http_tracker_http_port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("80")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据实际情况调整")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fastdfs.tracker_servers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("192.168.101.64:22122")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_3-2-文件上传、查询、下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-文件上传、查询、下载"}},[s._v("#")]),s._v(" 3.2 文件上传、查询、下载")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 文件上传\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fileUpload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.version="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.version"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 加载配置文件")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ClientGlobal.init(conf_filename);")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initByProperties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fastdfs-client.properties"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"network_timeout="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_network_timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ms"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"charset="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_charset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建tracker客户端")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerClient")]),s._v(" tracker "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerServer")]),s._v(" trackerServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tracker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageServer")]),s._v(" storageServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//定义一个storage客户端")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageClient1")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageClient1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trackerServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" storageServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//文件元信息")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NameValuePair")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" metaList "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NameValuePair")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            metaList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NameValuePair")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fileName"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\\\Users\\\\hspcadmin\\\\Desktop\\\\cat.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//执行上传")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" fileId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("upload_file1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\\\Users\\\\hspcadmin\\\\Desktop\\\\cat.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metaList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upload success. file id is: "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" fileId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//关闭tracker服务")]),s._v("\n            trackerServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 查询文件\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("queryFile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.version="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getProperty")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java.version"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 加载配置文件")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ClientGlobal.init(conf_filename);")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initByProperties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fastdfs-client.properties"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"network_timeout="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_network_timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ms"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"charset="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_charset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建tracker客户端")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerClient")]),s._v(" tracker "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerServer")]),s._v(" trackerServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tracker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageServer")]),s._v(" storageServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//定义一个storage客户端")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageClient1")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageClient1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trackerServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" storageServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//查询文件")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileInfo")]),s._v(" fileInfo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("query_file_info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileInfo")]),s._v(" fileInfo1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("query_file_info1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fileInfo1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//查询文件元信息")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NameValuePair")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" fileInfos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_metadata1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fileInfos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//关闭tracker服务")]),s._v("\n            trackerServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 文件下载\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("fileDownload")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 加载配置文件")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ClientGlobal.init(conf_filename);")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initByProperties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fastdfs-client.properties"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"network_timeout="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_network_timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ms"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"charset="')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClientGlobal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("g_charset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建tracker客户端")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerClient")]),s._v(" tracker "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TrackerServer")]),s._v(" trackerServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tracker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageServer")]),s._v(" storageServer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//定义一个storage客户端")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageClient1")]),s._v(" client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StorageClient1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trackerServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" storageServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//下载文件")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" fileBytes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("download_file1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),s._v(" file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("File")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:/chenyn.jpg"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileOutputStream")]),s._v("  fileOutputStream "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileOutputStream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fileOutputStream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fileBytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            fileOutputStream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//关闭tracker服务")]),s._v("\n            trackerServer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("1.如果有发生socker连接超时，注意查看linux机器的防火墙是否关闭")]),s._v(" "),t("p",[s._v("2.如果发现上传文件之后，文件目录下有-m，-big文件等，这些文件是上传文件的元数据")])]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者端口是否开放")]),s._v("\nvi /etc/sysconfig/iptables\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看开放的端口数量")]),s._v("\nservice iptables status\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看元数据文件, 是 参数author,height,width的键值对")]),s._v("\nvi test.png.m \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭元数据上传")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在调用client.upload_file()时，meta_list入参传null即可")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h2",{attrs:{id:"_4-文件服务案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-文件服务案例"}},[s._v("#")]),s._v(" 4 文件服务案例")]),s._v(" "),t("h3",{attrs:{id:"_4-1-需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-需求"}},[s._v("#")]),s._v(" 4.1 需求")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/fastdfs3.jpg",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("上传页面上传图片到"),t("code",[s._v("fastDFS")]),s._v("文件系统。")]),s._v(" "),t("ul",[t("li",[s._v("进入上传页面，点击上传图片，选择本地图片")]),s._v(" "),t("li",[s._v("选择本地图片后，进行上传，前端浏览器会通过"),t("code",[s._v("http")]),s._v("调用文件管理服务的文件上传接口进行上传")]),s._v(" "),t("li",[s._v("文件管理服务通过"),t("code",[s._v("socket")]),s._v("请求"),t("code",[s._v("FastDFS")]),s._v("文件系统的上传图片，最终图片保存在"),t("code",[s._v("FastDFS")]),s._v("文件系统中的"),t("code",[s._v("storage server")]),s._v("中。")])])]),s._v(" "),t("li",[t("p",[s._v("浏览上传的图片")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("进入视频下载页面")])]),s._v(" "),t("li",[t("p",[s._v("前端浏览器通过图片地址请求图片服务器代理"),t("code",[s._v("nginx")])])]),s._v(" "),t("li",[t("p",[s._v("图片服务器代理根据负载情况将图片浏览请求转发到一台"),t("code",[s._v("storage server")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("storage server")]),s._v("找到图片后通过"),t("code",[s._v("nginx")]),s._v("将图片响应给网友")])])])])]),s._v(" "),t("h3",{attrs:{id:"_4-2-安装-fastdfs、nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-安装-fastdfs、nginx"}},[s._v("#")]),s._v(" 4.2 安装 FastDFS、Nginx")]),s._v(" "),t("h4",{attrs:{id:"_4-2-1-安装fastdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-安装fastdfs"}},[s._v("#")]),s._v(" 4.2.1 安装FastDFS")]),s._v(" "),t("p",[s._v("参上")]),s._v(" "),t("h4",{attrs:{id:"_4-2-2-安装nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-安装nginx"}},[s._v("#")]),s._v(" 4.2.2 安装Nginx")]),s._v(" "),t("p",[s._v("首先参考"),t("a",{attrs:{href:"/dev/nginx/nginxstudy"}},[s._v("nginx基础入门")]),s._v("，了解和搭建"),t("code",[s._v("nginx")]),s._v("服务器")]),s._v(" "),t("h4",{attrs:{id:"_4-2-3-安装-fastdfs-nginx-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-安装-fastdfs-nginx-module"}},[s._v("#")]),s._v(" 4.2.3 安装 FastDFS-nginx-module")]),s._v(" "),t("p",[s._v("本文使用的是 "),t("code",[s._v("FastDFS-nginx-module_v1.16.tar.gz")])]),s._v(" "),t("p",[s._v("参考"),t("code",[s._v("github")]),s._v("地址：https://github.com/happyfish100/fastdfs-nginx-module")]),s._v(" "),t("p",[t("strong",[s._v("注意：要先关闭所有的"),t("code",[s._v("nginx")]),s._v("进程，再进行下面的步骤")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("调整 "),t("code",[s._v("fastdfs-nginx-module")]),s._v("配置")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调整 mod_fastdfs.conf配置 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入fastdfs-nginx-module解压目录")]),s._v("\ncd /home/chenyn/fastdfs/fastdfs-nginx-module/src\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制mod_fastdfs.conf复制到/etc/fdfs/里面")]),s._v("\ncp mod_fastdfs.conf /etc/fdfs/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调整mod_fastdfs.conf配置，根据实际情况调整路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改 base_path=/home/chenyn/fastdfs/FastDFS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改 tracker_server=192.168.209.128:22122")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改 store_path0=/home/chenyn/fastdfs/FastDFS/storage")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调整fastdfs-nginx-module的config文件 ")]),s._v("\n vi  config \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#（这一步很重要，很重要，很重要（重要的事情说三遍） ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CORE_INCS="$CORE_INCS /usr/local/include/fastdfs /usr/local/include/fastcommon/" --删除local')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CORE_LIBS="$CORE_LIBS -L/usr/local/lib -lfastcommon -lfdfsclient" --删除local')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重新编译nginx")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入解压的nginx目录（根据个人情况调整目录结构）")]),s._v("\ncd /home/chenyn/nginx/nginx-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.17.5")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置FastDFS-nginx-module 到nginx中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建临时目录 ")]),s._v("\nmkdir -p /var/temp/nginx \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用下面的命令")]),s._v("\n./configure \\\n    --add-module=/home/chenyn/fastdfs/fastdfs-nginx-module/src\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (/home/chenyn/fastdfs/fastdfs-nginx-module/src根据自己的文件目录来配)")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新编译")]),s._v("\nmake\nmake install\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"_4-2-4-配置nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-4-配置nginx"}},[s._v("#")]),s._v(" 4.2.4 配置nginx")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("只有一个"),t("code",[s._v("group")]),s._v("时，最简单的配置：当"),t("code",[s._v("mod_fastdfs.conf")]),s._v(" 配置文件中只有一个"),t("code",[s._v("group1")]),s._v(", 且配置了"),t("code",[s._v("url_have_group_name = false")]),s._v("时，即访问地址不使用分组名称，那么只需在"),t("code",[s._v("nginx")]),s._v("的配置文件中增加以下配置即可:（不推荐）")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入nginx配置目录")]),s._v("\ncd /usr/local/nginx/conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在nginx.conf里面的server{里面添加location /M00……}，添加下面的几行：")]),s._v("\nlocation /M00 {\n      root /home/chenyn/fastdfs/FastDFS/storage/data;\n          ngx_fastdfs_module;\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置负载均衡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#storage群group1组")]),s._v("\nupstream storage_server_group1{\n    \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.101.5")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" weight="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(";\n\t\tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.101.6")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" weight="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(";\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#storage群group2组")]),s._v("\nupstream storage_server_group2{\n    \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.101.7")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" weight="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(";\n\t\tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.101.8")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" weight="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(";\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("多个"),t("code",[s._v("group")]),s._v("配置，当配置多个组，且"),t("code",[s._v("mod_fastdfs.conf")]),s._v("里面指定了"),t("code",[s._v("url_have_group_name= true")]),s._v(" 时，配置方式:（建议即使用的是单个"),t("code",[s._v("group")]),s._v("，也按该方法配置）")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v(" location ~  /"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("["),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("]"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /M00 {\n        root /home/chenyn/fastdfs/FastDFS/storage/data;\n        ngx_fastdfs_module;\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如:在group1上的 nginx 的nginx.conf 配置是")]),s._v("\n  location  /group1/M00 {\n        root /home/chenyn/fastdfs/FastDFS/storage/data;\n        ngx_fastdfs_module;\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如:在group2上的 nginx 的nginx.conf 配置是")]),s._v("\n  location   /group2/M00 {\n        root /home/chenyn/fastdfs/FastDFS/storage/data;\n        ngx_fastdfs_module;\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("创建软连接")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据实际存储位置调整路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建软连接的目的是为了将M00虚拟路径转化一下")]),s._v("\nln -s /home/chenyn/fastdfs/FastDFS/storage/data /home/chenyn/fastdfs/FastDFS/storage/data/M00\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("调整"),t("code",[s._v("FastDFS")]),s._v("配置")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 FastDFS解压目录")]),s._v("\ncd /home/chenyn/fastdfs/FastDFS/conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移动配置文件")]),s._v("\ncp  http.conf   /etc/fdfs/\ncp  mime.types  /etc/fdfs/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("启动"),t("code",[s._v("FastDFS")]),s._v("、"),t("code",[s._v("nginx")])]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Tracker")]),s._v("\n/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Storage")]),s._v("\n/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动nginx")]),s._v("\ncd /usr/local/nginx/sbin\n./nginx -s restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-3-通过http访问fastdfs图片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-通过http访问fastdfs图片"}},[s._v("#")]),s._v(" 4.3 通过"),t("code",[s._v("HTTP")]),s._v("访问"),t("code",[s._v("FastDFS")]),s._v("图片")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("http://192.168.209.128/group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果可以正常查看或者下载，恭喜配置成功😙")]),s._v(" "),t("p",[s._v("如果失败，可以仔细查看一下上面的命令和配置，注意命令尽量不要复制，可能会有问题☺️")]),s._v(" "),t("h3",{attrs:{id:"_4-4-安装-fastdht实现文件去重处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-安装-fastdht实现文件去重处理"}},[s._v("#")]),s._v(" 4.4 安装 "),t("code",[s._v("FastDHT")]),s._v("实现文件去重处理")]),s._v(" "),t("p",[t("code",[s._v("FastDHT")]),s._v("是一个高性能的分布式哈希系统，它是基于键值对存储的，而且它需要依赖于"),t("code",[s._v("Berkeley DB")]),s._v("作为数据存储的媒介，同时需要依赖于"),t("code",[s._v("libfastcommon")]),s._v("。")]),s._v(" "),t("p",[t("code",[s._v("FastDHT")]),s._v("集群由一个或者多个组"),t("code",[s._v("group")]),s._v("组成，同组服务器上存储的数据是相同的，数据同步只在组的服务器之间进行；组内各个服务是对等的，对数据进行存取时，可以根据 "),t("code",[s._v("key")]),s._v("的"),t("code",[s._v("hash")]),s._v("值来决定使用哪台机器。")]),s._v(" "),t("h4",{attrs:{id:"_4-4-1-安装berkeley-db"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-安装berkeley-db"}},[s._v("#")]),s._v(" 4.4.1 安装"),t("code",[s._v("Berkeley DB")])]),s._v(" "),t("p",[s._v("在安装"),t("code",[s._v("FastDHT")]),s._v("之前，需要首先安装"),t("code",[s._v("Berkeley DB")]),s._v("，也需要安装"),t("code",[s._v("libfastcommon")]),s._v("，不过这安装"),t("code",[s._v("FastDFS")]),s._v("时已经安装了"),t("code",[s._v("libfastcommon")]),s._v("，所以这里省略。")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 berkeley-db")]),s._v("\ncd /home/chenyn/fastdfs\nwget http://download.oracle.com/berkeley-db/db-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.7.25")]),s._v(".tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\ntar -zxvf db-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.7.25")]),s._v(".tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入解压目录")]),s._v("\ncd db-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.7.25")]),s._v("/build_unix\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证安装环境（安装到了/usr目录下）")]),s._v("\nsudo ../dist/configure --prefix=/usr\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译，从Makefile中读取指令，然后编译")]),s._v("\nsudo make\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装，从Makefile中读取指令，安装到指定位置")]),s._v("\nsudo make install\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h4",{attrs:{id:"_4-4-2-安装fastdht"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-安装fastdht"}},[s._v("#")]),s._v(" 4.4.2 安装FastDHT")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("cd /home/chenyn/fastdfs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget下载FastDHT安装包 （可以根据实际情况选择版本）")]),s._v("\nwget http://sourceforge.net/projects/fastdht/files/FastDHT%20server%20and%20php%20ext/FastDHT%20Server%20Source%20Code%20V2."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v("/FastDHT_v2."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(".tar.gz\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\ntar –zxvf FastDHT_v2."),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(".tar.gz\ncd FastDHT\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译之前需要修改make.sh")]),s._v("\nvi make.sh\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件中的 “CFLAGS='-Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE'” 修改为 “CFLAGS='-Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -I/usr/include/ -L/usr/lib/'” （-I/usr/include/ -L/usr/lib/）这里对应上面Berkeley的安装目录")]),s._v("\nsudo ./make.sh\nsudo ./make.sh install\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"_4-4-3-配置fastdht"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-配置fastdht"}},[s._v("#")]),s._v(" 4.4.3 配置FastDHT")]),s._v(" "),t("p",[s._v("先确认目录"),t("code",[s._v("/data/fastdht/")]),s._v("已创建，如果没有创建，执行以下命令创建目录：")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("mkdir -p /data/fastdht\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置fdht_client.conf文件")]),s._v("\ncd /etc/fdht\nvi fdht_client.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改下面配置")]),s._v("\nbase_path=/data/fastdht\nkeep_alive="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include /etc/fdht/fdht_servers.conf   ---该配置不是注释，一定要加!!!")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置fdht_servers.conf")]),s._v("\nvi fdht_servers.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据fdht的机器数量调整，下面为1台参考配置")]),s._v("\ngroup_count="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ngroup0="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168.209.128")]),s._v(";"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11411")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置fdhtd.conf")]),s._v("\nvi fdhtd.conf\nport="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11411")]),s._v("\nbash_path=/data/fastdht\ncache_size=32MB\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include /etc/fdht/fdht_servers.conf ---该配置不是注释，一定要加!!!")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置fastdfs的storage.conf")]),s._v("\nvi /etc/fdfs/storage.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否检查上传文件已经存在。如果已经存在，则建立一个索引链接以节省空间")]),s._v("\ncheck_file_duplicate="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# check_file_duplicate=1时，FastDHT的命名空间")]),s._v("\nkey_namespace=FastDFS\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 长连接配置选项，0为短连接 1为长连接")]),s._v("\nkeep_alive="),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include /etc/fdht/fdht_servers.conf ---该配置不是注释，一定要加!!!")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("h4",{attrs:{id:"_4-4-4-启动fastdht"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-4-启动fastdht"}},[s._v("#")]),s._v(" 4.4.4 启动"),t("code",[s._v("FastDHT")])]),s._v(" "),t("p",[s._v("启动前关闭防火墙，或者开启端口（11411）")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[s._v("vi /etc/sysconfig/iptables\n添加如下端口行：\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FastDHT Port")]),s._v("\n-A INPUT -m state --state NEW -m tcp -p tcp --dport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11411")]),s._v(" -j ACCEPT\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改之后重启防火墙：")]),s._v("\n service iptables restart\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之后，就可以直接启动FastDHT了。")]),s._v("\n /usr/local/bin/fdhtd /etc/fdht/fdhtd.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以监控11411端口号的使用情况，确认是否启动成功。")]),s._v("\n netstat –unltp | grep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11411")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"_4-4-5-上传测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-5-上传测试"}},[s._v("#")]),s._v(" 4.4.5 上传测试")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("3.2节")]),s._v("的上传方法上传重复文件，进入"),t("code",[s._v("/M00/00/00")]),s._v(" 查看")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/fdht.jpg",alt:""}})]),s._v(" "),t("p",[s._v("出现上图，软连接指向，恭喜~~😃")]),s._v(" "),t("h3",{attrs:{id:"_4-5-常见错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-常见错误"}},[s._v("#")]),s._v(" 4.5 常见错误")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("配置"),t("code",[s._v("FastDFS-nginx-moudle")]),s._v("发生"),t("code",[s._v("nginx")]),s._v("访问不了的情况，查看"),t("code",[s._v("nginx")]),s._v("启动日志，按错误信息排查")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#Nginx 服务器启动失败的，错误信息：trunk_shared.c, line: 177, "Permission denied" can\'t be accessed')]),s._v("\n只需修改Nginx配置文件，输入命令 “ vi /usr/local/nginx/conf/nginx.conf ”,在配置文件的开头加入 “ user root; ” 即可\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx日志报错ERROR - file: ../common/fdfs_global.c, line: 52, the format of filename")]),s._v("\nvi /etc/fdfs/mod_fastdfs.conf\n将  url_have_group_name=false 改为 url_have_group_name=true\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他常见问题,或者根据日志错误信息找百度")]),s._v("\nhttp://www.mamicode.com/info-detail-"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1992668")]),s._v(".html\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])])]),s._v(" "),t("h1",{attrs:{id:"启动fdht报错：error-while-loading-shared-libraries-xxx-so-0-cannot-open-shared-object-file-no-such-file-or-directory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动fdht报错：error-while-loading-shared-libraries-xxx-so-0-cannot-open-shared-object-file-no-such-file-or-directory"}},[s._v("#")]),s._v(" 启动fdht报错：error while loading shared libraries: xxx.so.0:cannot open shared object file: No such file or directory")]),s._v(" "),t("p",[s._v("出现这类错误表示，系统不知道xxx.so放在哪个目录下，这时候就要在/etc/ld.so.conf中加入xxx.so所在的目录。\n一般而言，有很多的so会存放在/usr/local/lib这个目录底下，去这个目录底下找，果然发现自己所需要的.so文件。\n所以，在/etc/ld.so.conf中加入/usr/local/lib这一行，保存之后，再运行：/sbin/ldconfig –v 更新一下配置即可。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);