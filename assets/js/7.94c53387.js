(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{354:function(s,a,t){"use strict";t.r(a);var n=t(44),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx-代理服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-代理服务器"}},[s._v("#")]),s._v(" nginx(代理服务器)")]),s._v(" "),t("h2",{attrs:{id:"nginx安装（linux）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装（linux）"}},[s._v("#")]),s._v(" nginx安装（linux）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("安装nginx环境依赖")]),s._v(" "),t("ul",[t("li",[s._v("配置yum源")]),s._v(" "),t("li",[s._v("安装pcre 依赖、安装 openssl 、 zlib 、 gcc 依赖")])])]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx 官网下载软件"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("使用"),t("code",[s._v("tar -zxvf ***")]),s._v("命令解压、"),t("code",[s._v("./configure")]),s._v("命令、"),t("code",[s._v("make && make install")]),s._v("命令配置编译")])]),s._v(" "),t("li",[t("p",[s._v("这里也可以指定临时文件的目录")]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建临时目录 ")]),s._v("\nmkdir -p /var/temp/nginx \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用下面的命令")]),s._v("\n./configure \\\n    --prefix=/usr/local/nginx \\\n    --pid-path=/var/run/nginx/nginx.pid \\\n    --lock-path=/var/lock/nginx.lock \\\n    --error-log-path=/var/log/nginx/error.log \\\n    --http-log-path=/var/log/nginx/access.log \\\n    --with-http_gzip_static_module \\\n    --http-client-body-temp-path=/var/temp/nginx/client \\\n    --http-proxy-temp-path=/var/temp/nginx/proxy \\\n    --http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\\n    --http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\\n    --http-scgi-temp-path=/var/temp/nginx/scgi \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("启动nginx，进入目录 "),t("code",[s._v("/usr/local/nginx/sbin")]),s._v("中，"),t("code",[s._v("./nginx")]),s._v("启动nginx")])])]),s._v(" "),t("h2",{attrs:{id:"测试访问nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试访问nginx"}},[s._v("#")]),s._v(" 测试访问nginx")]),s._v(" "),t("h3",{attrs:{id:"linux开启80端口访问权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux开启80端口访问权限"}},[s._v("#")]),s._v(" linux开启80端口访问权限")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("vi /etc/sysconfig/iptables")]),s._v("、打开iptables的配置文件，添加一行")]),s._v(" "),t("p",[t("code",[s._v("-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("输入"),t("code",[s._v("service iptables restart")]),s._v("重启服务。")])]),s._v(" "),t("li",[t("p",[s._v("输入"),t("code",[s._v("service iptables status")]),s._v("，回车就会显示正在生效的规则。")])])]),s._v(" "),t("div",{staticClass:"language-cmake line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cmake"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 注意 firewalld 和 iptables 根据不同linux机器不同")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有些人安装的linux的系统默认防火墙不是iptables,而是firewall,那就得使用以下方式关闭防火墙了。")]),s._v("\nsystemctl stop firewalld.service            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止firewall")]),s._v("\nsystemctl disable firewalld.service        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#禁止firewall开机启动")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 选择合适的方式开放端口")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v('远程访问，ip:80端口，显示："Welcome to nginx!"。安装成功')])]),s._v(" "),t("h2",{attrs:{id:"ngnix常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ngnix常用命令"}},[s._v("#")]),s._v(" ngnix常用命令")]),s._v(" "),t("ul",[t("li",[s._v("进入目录"),t("code",[s._v("/usr/local/nginx/sbin")])])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("nginx #打开 nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-s reload|reopen|stop|quit  #重新加载配置|重启|停止|退出 nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-t   #测试配置是否有语法错误")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("[-?hvVtq] [-s signal] [-c filename] [-p prefix] [-g directives]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-?,-h")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("打开帮助信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-v")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("显示版本信息并退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-V")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("显示版本和配置选项信息，然后退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-t")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("检测配置文件是否有语法错误，然后退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-q")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("在检测配置文件期间屏蔽非错误信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-s")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("signal       : 给一个 nginx 主进程发送信号：stop（停止）, quit（退出）, reopen（重启）, reload（重新加载配置文件）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("prefix       : 设置前缀路径（默认是：/usr/local/Cellar/nginx/1.2.6/）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("filename     : 设置配置文件（默认是：/usr/local/etc/nginx/nginx.conf）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-g")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("directives   : 设置配置文件外的全局指令")]),s._v("\n\n注意：执行./nginx启动nginx，这里可以-c指定加载的nginx配置文件，如下：\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    ./nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-c /usr/local/nginx/conf/nginx.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("如果不指定-c，nginx在启动时默认加载conf/nginx.conf文件，此文件的地址也可以在编译安装nginx时指定./configure的参数（--conf-path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("指向配置文件（nginx.conf））")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("./nginx")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("./nginx")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" -s stop")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("或者全部停止")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("./nginx -s quit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启ngnix")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("./ngnix")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-s reload")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看ngnix  状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("netstat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-tupln | grep ngnix")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h2",{attrs:{id:"nginx配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置文件"}},[s._v("#")]),s._v(" nginx配置文件")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("配置文件目录"),t("code",[s._v("/usr/local/nginx/conf")]),s._v("下的nginx.conf")])]),s._v(" "),t("li",[t("p",[s._v("包含三部分内容")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("全局块：配置服务器整体运行的配置指令\n比如 worker_processes 1; 处理并发数的配置")])]),s._v(" "),t("li",[t("p",[s._v("events 块 ：影响 Nginx 服务器与用户的网络连接\n比如 worker_connections 1024; 支持的最大连接数为 1024")])]),s._v(" "),t("li",[t("p",[s._v("http 块")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("Nginx的HTTP配置主要包括三个区块，结构如下：\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("http")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("{ //这个是协议级别")]),s._v("\n　　include mime.types;\n　　default_type application/octet-stream;\n　　keepalive_timeout 65;\n　　gzip on;\n　　　　server { //这个是服务器级别\n　　　　　　listen 80;\n　　　　　　server_name localhost;\n　　　　　　　　location / { //这个是请求级别\n　　　　　　　　　　root html;\n　　　　　　　　　　index index.html index.htm;\n　　　　　　　　}\n　　　　　　}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("还包含两部分：\nhttp 全局块\nserver 块")])])])])]),s._v(" "),t("h2",{attrs:{id:"反向代理demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反向代理demo"}},[s._v("#")]),s._v(" 反向代理Demo")]),s._v(" "),t("p",[t("strong",[s._v("代理")]),s._v("：")]),s._v(" "),t("p",[s._v("在Java设计模式中，代理模式是这样定义的：给某个对象提供一个代理对象，并由代理对象控制原对象的引用。")]),s._v(" "),t("p",[s._v("在举一个现实生活中的例子：比如我们要买一间二手房，虽然我们可以自己去找房源，但是这太花费时间精力了，而且房屋质量检测以及房屋过户等一系列手续也都得我们去办，再说现在这个社会，等我们找到房源，说不定房子都已经涨价了，那么怎么办呢？最简单快捷的方法就是找二手房中介公司（为什么？别人那里房源多啊），于是我们就委托中介公司来给我找合适的房子，以及后续的质量检测过户等操作，我们只需要选好自己想要的房子，然后交钱就行了。")]),s._v(" "),t("p",[s._v("代理简单来说，就是如果我们想做什么，但又不想直接去做，那么这时候就找另外一个人帮我们去做。那么这个例子里面的中介公司就是给我们做代理服务的，我们委托中介公司帮我们找房子。")]),s._v(" "),t("p",[t("strong",[s._v("正向代理代理客户端，反向代理代理服务器：")])]),s._v(" "),t("p",[s._v("即"),t("strong",[s._v("正向代理时在客户端运行，反向代理时在服务器上运行")])]),s._v(" "),t("p",[s._v("反向代理，其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器IP地址。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/proxy.jpg",alt:"代理"}})]),s._v(" "),t("h3",{attrs:{id:"demo1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo1"}},[s._v("#")]),s._v(" Demo1")]),s._v(" "),t("p",[s._v("预期效果：打开浏览器，在浏览器地址栏输入地址 www.chenyn.com ，跳转到 liunx 系统 tomcat 主页\n面中")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("配置启动tomcat")]),s._v(" "),t("ul",[t("li",[s._v("解压tomcat，进入bin下运行程序")]),s._v(" "),t("li",[s._v("开放8080端口")])])]),s._v(" "),t("li",[t("p",[s._v("配置域名映射ip")]),s._v(" "),t("ul",[t("li",[s._v("进入windows的 系统盘/windows/system32/drivers/etc")]),s._v(" "),t("li",[s._v("编辑hosts，新增"),t("code",[s._v("192.168.209.128 www.chenyn.com")])])])]),s._v(" "),t("li",[t("p",[s._v("配置nginx.conf")]),s._v(" "),t("ul",[t("li",[s._v("修改http配置块下面的server块的"),t("code",[s._v("location /")]),s._v(" 块")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            root")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("  html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" http://127.0.0.1:8080;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" index.html index.htm;")]),s._v("\n        }\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("访问www.chenyn.com:80 可以访问到tomcat页面")])])]),s._v(" "),t("h3",{attrs:{id:"demo2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo2"}},[s._v("#")]),s._v(" Demo2")]),s._v(" "),t("p",[s._v("预取效果：使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中、nginx 监听端口为 9001")]),s._v(" "),t("p",[s._v("访问 http:// 192.168.209.128 :9001/edu/ 直接跳转到 127.0.0.1:8080\n访问 http:// 192.168.209.128 :9001/vod/ 直接跳转到 127.0.0.1:8081")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("准备两个 tomcat 服务器，一个 8080 端口，一个 8081 端口、创建文件夹和测试页面")])]),s._v(" "),t("li",[t("p",[s._v("开放端口8080、8081、9001")])]),s._v(" "),t("li",[t("p",[s._v("配置nginx.conf，修改http配置块下面的server块的"),t("code",[s._v("location /")]),s._v(" 块")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("~ /edu/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            root")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("  html;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" http://127.0.0.1:8080;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            index")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" index.html index.htm;")]),s._v("\n        }\n\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("~ /vod/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("           proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" http://127.0.0.1:8081;")]),s._v("\n        }\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("访问192.168.209.128:9001/edu/test.html和192.168.209.128:9001/vod/test.html")]),s._v(" "),t("p",[s._v("会页面会跳转到8080 和8081 服务器")])])]),s._v(" "),t("h2",{attrs:{id:"负载均衡demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡demo"}},[s._v("#")]),s._v(" 负载均衡Demo")]),s._v(" "),t("p",[s._v("预期效果：浏览器地址栏输入地址 http://192.168.17.129:9001/edu/test.html ，负载均衡效果，平均 8080 和 8081 端口中")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("启动两台tomcat,8080\\8081")])]),s._v(" "),t("li",[t("p",[s._v("配置nginx.conf\\修改http配置块，注意多个location会导致负载均衡失效")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("upstream")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("myserver {")]),s._v("\n      ip_bash;\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("      server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" 127.0.0.1:8080 weight=1;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("      server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" 127.0.0.1:8081 weight=1;")]),s._v("\n    }\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("        listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("      80;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("        server_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" localhost;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://myserver;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("            proxy_set_header")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("Host $host;")]),s._v("\n        }\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("注意浏览器的缓存，尽量用chrome 的无痕模式访问。")])]),s._v(" "),t("li",[t("p",[s._v("负载均衡策略")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("1、轮询（默认）\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("down 掉，能自动剔除。")]),s._v("\n\n2、权重-weight\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("weight")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("代表权重默认为 1, 权重越高被分配的客户端越多")]),s._v("\n\n3、ip_hash（session共享问题）\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("每个请求按访问")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("4、")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("fair （第三方）")]),s._v("\n按后端服务器的响应时间来分配请求，响应时间短的优先分配。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"动静分离demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#动静分离demo"}},[s._v("#")]),s._v(" 动静分离Demo")]),s._v(" "),t("p",[t("code",[s._v("Nginx 动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用Nginx 处理静态页面，Tomcat处理动态页面")])]),s._v(" "),t("p",[s._v("一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前"),t("strong",[s._v("主流推崇")]),s._v("的方案；")]),s._v(" "),t("p",[s._v("另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。 通过 location 指定不同的后缀名实现不同的请求转发")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("服务器上新增静态资源文件夹")])]),s._v(" "),t("li",[t("p",[s._v("配置nginx.conf")]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[s._v("     \n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/www/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("           root")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" /home/chenyn/data/;")]),s._v("\n        }\n\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("        location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/image/ {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("           root")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" /home/chenyn/data/;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("           ## 显示文件目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("           autoindex")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(" on;")]),s._v("\n        }\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("root 详解")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location ^~ /t/ {\n     root /www/root/html/;\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如果一个请求的URI是/t/a.html时，web服务器将会返回服务器上的/www/root/html/t/a.html的文件。")])])]),s._v(" "),t("h2",{attrs:{id:"_8-nginx-配置高可用的集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-nginx-配置高可用的集群"}},[s._v("#")]),s._v(" 8 nginx 配置高可用的集群")]),s._v(" "),t("p",[s._v("待新增")]),s._v(" "),t("h2",{attrs:{id:"_9-nginx原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-nginx原理"}},[s._v("#")]),s._v(" 9  nginx原理")]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/nginx.jpg",alt:"运行原理"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/image/nginx2.jpg",alt:"工作原理"}})]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("master-workers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("的机制的好处")]),s._v("\n首先，对于每个\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("worker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("进程来说，独立的进程，不需要加锁，所以省掉了锁带来的开销，")]),s._v("\n同时在编程以及问题查找时，也会方便很多。其次，采用独立的进程，可以让互相之间不会\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("影响，一个进程退出后，其它进程还在工作，服务不会中断，")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("master 进程则很快启动新的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("worker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("进程。当然， worker 进程的异常退出，肯定是程序有 bug 了，异常退出，会导致当")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("前")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("worker 上的所有请求失败，不过不会影响到所有请求，所以降低了风险。")]),s._v("\n\n需要设置多少个\nworker\nNginx\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("同")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("redis 类似都采用了 io 多路复用机制，每个 worker 都是一个独立的进程，但每个进")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("程里只有一个主线程，通过异步非阻塞的方式来处理请求，")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("即使是千上万个请求也不在话")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("下。每个")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("worker 的线程可以把一个 cpu 的性能发挥到极致。所以 worker 数和服务器的 cpu")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("数相等是最为适宜的。设少了会浪费")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("cpu ，设多了会造成 cpu 频繁切换上下文带来的损耗。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);