<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FastDFS(åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ) | chenyanan ã® blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/master/icon/ico-pig.png">
    <meta name="description" content="å­¦ä¹ æœ€å¥½çš„æ—¶é—´å°±æ˜¯ç°åœ¨">
    <link rel="preload" href="/master/assets/css/0.styles.987710d3.css" as="style"><link rel="preload" href="/master/assets/js/app.2082b23a.js" as="script"><link rel="preload" href="/master/assets/js/2.926fc16b.js" as="script"><link rel="preload" href="/master/assets/js/6.5babb80d.js" as="script"><link rel="prefetch" href="/master/assets/js/10.5a0e9bef.js"><link rel="prefetch" href="/master/assets/js/11.8dc6e519.js"><link rel="prefetch" href="/master/assets/js/3.73bee7b8.js"><link rel="prefetch" href="/master/assets/js/4.200ee988.js"><link rel="prefetch" href="/master/assets/js/5.c23ae111.js"><link rel="prefetch" href="/master/assets/js/7.94c53387.js"><link rel="prefetch" href="/master/assets/js/8.5914f281.js"><link rel="prefetch" href="/master/assets/js/9.5b4c3f01.js">
    <link rel="stylesheet" href="/master/assets/css/0.styles.987710d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/master/" class="home-link router-link-active"><!----> <span class="site-name">chenyanan ã® blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/master/00.mydocslist/" class="nav-link">
  æˆ‘çš„å·¥ç¨‹
</a></div><div class="nav-item"><a href="/master/01.dev/" class="nav-link router-link-active">
  åç«¯
</a></div><div class="nav-item"><a href="/master/02.front/" class="nav-link">
  å‰ç«¯
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/ching7" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/master/00.mydocslist/" class="nav-link">
  æˆ‘çš„å·¥ç¨‹
</a></div><div class="nav-item"><a href="/master/01.dev/" class="nav-link router-link-active">
  åç«¯
</a></div><div class="nav-item"><a href="/master/02.front/" class="nav-link">
  å‰ç«¯
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/ching7" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubåœ°å€
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginxåŸºç¡€å…¥é—¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>FastDFSå®‰è£…å’Œä½¿ç”¨</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html" aria-current="page" class="active sidebar-link">FastDFS(åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_1-ä»€ä¹ˆæ˜¯fastdfs" class="sidebar-link">1  ä»€ä¹ˆæ˜¯FastDFS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_1-1-ç®€ä»‹" class="sidebar-link">1.1  ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_1-2-å·¥ä½œåŸç†" class="sidebar-link">1.2  å·¥ä½œåŸç†</a></li></ul></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_2-fastdfså…¥é—¨" class="sidebar-link">2 FastDFSå…¥é—¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_2-1-fastdfså®‰è£…é…ç½®-tracker" class="sidebar-link">2.1 FastDFSå®‰è£…é…ç½®(tracker)</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_2-2-fastdfså®‰è£…é…ç½®-storage" class="sidebar-link">2.2 FastDFSå®‰è£…é…ç½®(storage)</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_2-3-æµ‹è¯•fastdfsæ˜¯å¦å®‰è£…æˆåŠŸ" class="sidebar-link">2.3 æµ‹è¯•FastDFSæ˜¯å¦å®‰è£…æˆåŠŸ</a></li></ul></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_3-springbootæ•´åˆfastdfså®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æµ‹è¯•" class="sidebar-link">3 SpringBootæ•´åˆFastDFSå®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æµ‹è¯•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_3-1-ç¯å¢ƒæ­å»º" class="sidebar-link">3.1 ç¯å¢ƒæ­å»º</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_3-2-æ–‡ä»¶ä¸Šä¼ ã€æŸ¥è¯¢ã€ä¸‹è½½" class="sidebar-link">3.2 æ–‡ä»¶ä¸Šä¼ ã€æŸ¥è¯¢ã€ä¸‹è½½</a></li></ul></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_4-æ–‡ä»¶æœåŠ¡æ¡ˆä¾‹" class="sidebar-link">4 æ–‡ä»¶æœåŠ¡æ¡ˆä¾‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_4-1-éœ€æ±‚" class="sidebar-link">4.1 éœ€æ±‚</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_4-2-å®‰è£…-fastdfsã€nginx" class="sidebar-link">4.2 å®‰è£… FastDFSã€Nginx</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_4-3-é€šè¿‡httpè®¿é—®fastdfså›¾ç‰‡" class="sidebar-link">4.3 é€šè¿‡HTTPè®¿é—®FastDFSå›¾ç‰‡</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_4-4-å®‰è£…-fastdhtå®ç°æ–‡ä»¶å»é‡å¤„ç†" class="sidebar-link">4.4 å®‰è£… FastDHTå®ç°æ–‡ä»¶å»é‡å¤„ç†</a></li><li class="sidebar-sub-header"><a href="/master/01.dev/10.fastdfs/fastdfsStudy.html#_4-5-å¸¸è§é”™è¯¯" class="sidebar-link">4.5 å¸¸è§é”™è¯¯</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="fastdfs-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ"><a href="#fastdfs-åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ" class="header-anchor">#</a> FastDFS(åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ)</h1> <h2 id="_1-ä»€ä¹ˆæ˜¯fastdfs"><a href="#_1-ä»€ä¹ˆæ˜¯fastdfs" class="header-anchor">#</a> 1  ä»€ä¹ˆæ˜¯FastDFS</h2> <h3 id="_1-1-ç®€ä»‹"><a href="#_1-1-ç®€ä»‹" class="header-anchor">#</a> 1.1  ç®€ä»‹</h3> <p><code>FastDFS</code>æ˜¯ç”¨cè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ç”±æ·˜å®èµ„æ·±æ¶æ„å¸ˆä½™åº†ç¼–å†™å¹¶å¼€æºã€‚<code>FastDFS</code>ä¸“ä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨<code>FastDFS</code>å¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚</p> <p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>FastDFS</code>å‘¢ï¼Ÿ</p> <p>å·²æœ‰çš„çš„<code>NFS</code>ã€<code>GFS</code>éƒ½æ˜¯é€šç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œé€šç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜ç‚¹çš„æ˜¯å¼€å‘ä½“éªŒå¥½ï¼Œä½†æ˜¯ç³»ç»Ÿå¤æ‚æ€§é«˜ã€æ€§èƒ½ä¸€èˆ¬ï¼Œè€Œä¸“ç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè™½ç„¶å¼€å‘ä½“éªŒæ€§å·®ï¼Œä½†æ˜¯ç³»ç»Ÿå¤æ‚æ€§ä½å¹¶ä¸”æ€§èƒ½é«˜ã€‚</p> <p><code>FastDFS</code>éå¸¸é€‚åˆå­˜å‚¨å›¾ç‰‡ç­‰é‚£äº›å°æ–‡ä»¶ï¼Œ<code>FastDFS</code>ä¸å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å—ï¼Œæ‰€ä»¥å®ƒå°±æ²¡æœ‰åˆ†å—åˆå¹¶çš„å¼€é”€ï¼Œ<code>FastDFS</code>ç½‘ç»œé€šä¿¡é‡‡ç”¨<code>socket</code>ï¼Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚</p> <h3 id="_1-2-å·¥ä½œåŸç†"><a href="#_1-2-å·¥ä½œåŸç†" class="header-anchor">#</a> 1.2  å·¥ä½œåŸç†</h3> <h4 id="_1-2-1-fastdsfæ¶æ„"><a href="#_1-2-1-fastdsfæ¶æ„" class="header-anchor">#</a> 1.2.1 <code>FastDSF</code>æ¶æ„</h4> <p><img src="/image/fastdfs.jpg" alt=""></p> <p><code>FastDFS</code>æ¶æ„åŒ…æ‹¬ <code>Tracker server</code>å’Œ<code>Storag eserver</code>ã€‚å®¢æˆ·ç«¯è¯·æ±‚<code>Tracker server</code>è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡<code>Tracker server</code>è°ƒåº¦æœ€ç»ˆç”±<code>Storage server</code>å®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚</p> <ul><li><p>Tracker</p> <p><code>Tracker Server</code>ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡<code>Tracker server</code>åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ä¸€äº›ç­–ç•¥æ‰¾åˆ°<code>Storage server</code>æä¾›æ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚å¯ä»¥å°†<code>Tracker</code>ç§°ä¸ºè¿½è¸ªæœåŠ¡å™¨æˆ–è°ƒåº¦æœåŠ¡å™¨ã€‚</p> <p><code>Tracker server</code>æ›´åƒä¸€ä¸ªç®¡ç†æŒ‡æŒ¥å‘˜ï¼Œç®¡ç†<code>Storage server</code>ï¼Œåè°ƒå®¢æˆ·æœºå°†æ–‡ä»¶ä¸Šä¼ åˆ°<code>Storage Server</code></p> <p><code>FastDFS</code>é›†ç¾¤ä¸­çš„<code>Tracker server</code>å¯ä»¥æœ‰å¤šå°ï¼Œ<code>Tracker server</code>ä¹‹é—´æ˜¯ç›¸äº’å¹³ç­‰å…³ç³»åŒæ—¶æä¾›æœåŠ¡ï¼Œ<code>Tracker server</code>ä¸å­˜åœ¨å•ç‚¹æ•…éšœã€‚å®¢æˆ·ç«¯è¯·æ±‚<code>racker server</code>é‡‡ç”¨è½®è¯¢æ–¹å¼ï¼Œå¦‚æœè¯·æ±‚çš„<code>tracker</code>æ— æ³•æä¾›æœåŠ¡åˆ™æ¢å¦ä¸€ä¸ª<code>tracker</code>ã€‚</p></li> <li><p>Storage</p> <p><code>Storage Server</code>ä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨<code>Storage</code>æœåŠ¡å™¨ä¸Šï¼Œ<code>Storage server</code>æ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶ã€‚å¯ä»¥å°†<code>storage</code>ç§°ä¸ºå­˜å‚¨æœåŠ¡å™¨ã€‚</p> <p><code>Storage</code>é›†ç¾¤é‡‡ç”¨äº†åˆ†ç»„å­˜å‚¨æ–¹å¼ã€‚<code>storage</code>é›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç»„æ„æˆï¼Œé›†ç¾¤å­˜å‚¨æ€»å®¹é‡ä¸ºé›†ç¾¤ä¸­æ‰€æœ‰ç»„çš„å­˜å‚¨å®¹é‡ä¹‹å’Œã€‚ä¸€ä¸ªç»„ç”±ä¸€å°æˆ–å¤šå°å­˜å‚¨æœåŠ¡å™¨ç»„æˆï¼Œç»„å†…çš„<code>Storage server</code>ä¹‹é—´æ˜¯å¹³ç­‰å…³ç³»ï¼Œä¸åŒç»„çš„<code>Storage server</code>ä¹‹é—´ä¸ä¼šç›¸äº’é€šä¿¡ï¼ŒåŒç»„å†…çš„<code>Storage server</code>ä¹‹é—´ä¼šç›¸äº’è¿æ¥è¿›è¡Œæ–‡ä»¶åŒæ­¥ï¼Œä»è€Œä¿è¯åŒç»„å†…æ¯ä¸ª<code>storage</code>ä¸Šçš„æ–‡ä»¶å®Œ
å…¨ä¸€è‡´çš„ã€‚ä¸€ä¸ªç»„çš„å­˜å‚¨å®¹é‡ä¸ºè¯¥ç»„å†…å­˜å‚¨æœåŠ¡å™¨å®¹é‡æœ€å°çš„é‚£ä¸ªï¼Œç”±æ­¤å¯è§ç»„å†…å­˜å‚¨æœåŠ¡å™¨çš„è½¯ç¡¬ä»¶é…ç½®æœ€å¥½æ˜¯ä¸€è‡´çš„ã€‚</p> <p>é‡‡ç”¨åˆ†ç»„å­˜å‚¨æ–¹å¼çš„å¥½å¤„æ˜¯çµæ´»ã€å¯æ§æ€§è¾ƒå¼ºã€‚æ¯”å¦‚ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯ç›´æ¥æŒ‡å®šä¸Šä¼ åˆ°çš„ç»„ä¹Ÿå¯ä»¥ç”±<code>tracker</code>è¿›è¡Œè°ƒåº¦é€‰æ‹©ã€‚ä¸€ä¸ªåˆ†ç»„çš„å­˜å‚¨æœåŠ¡å™¨è®¿é—®å‹åŠ›è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åœ¨è¯¥ç»„å¢åŠ å­˜å‚¨æœåŠ¡å™¨æ¥æ‰©å……æœåŠ¡èƒ½åŠ›ï¼ˆçºµå‘æ‰©å®¹ï¼‰ã€‚å½“ç³»ç»Ÿå®¹é‡ä¸è¶³æ—¶ï¼Œå¯ä»¥å¢åŠ ç»„æ¥æ‰©å……å­˜å‚¨å®¹é‡ï¼ˆæ¨ªå‘æ‰©å®¹ï¼‰ã€‚</p></li> <li><p><code>Storage</code>çŠ¶æ€æ”¶é›†</p> <p><code>Storage server</code>ä¼šè¿æ¥é›†ç¾¤ä¸­æ‰€æœ‰çš„<code>Tracker server</code>ï¼Œå®šæ—¶å‘ä»–ä»¬æŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ç£ç›˜å‰©ä½™ç©ºé—´ã€æ–‡ä»¶åŒæ­¥çŠ¶å†µã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ¬¡æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚</p></li></ul> <h4 id="_1-2-2-æ–‡ä»¶ä¸Šä¼ æµç¨‹"><a href="#_1-2-2-æ–‡ä»¶ä¸Šä¼ æµç¨‹" class="header-anchor">#</a> 1.2.2 æ–‡ä»¶ä¸Šä¼ æµç¨‹</h4> <p><img src="/image/fastdfs1.jpg" alt="fastdfsä¸Šä¼ æµç¨‹"></p> <p>å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶åå­˜å‚¨æœåŠ¡å™¨å°†æ–‡ä»¶IDè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ–‡ä»¶IDç”¨äºä»¥åè®¿é—®è¯¥æ–‡ä»¶çš„ç´¢å¼•ä¿¡æ¯ã€‚æ–‡ä»¶ç´¢å¼•ä¿¡æ¯åŒ…æ‹¬ï¼šç»„åï¼Œè™šæ‹Ÿç£ç›˜è·¯å¾„ï¼Œæ•°æ®ä¸¤çº§ç›®å½•ï¼Œæ–‡ä»¶åã€‚</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>group1/M00/00/00/wKjRgF3PPvOAOF7HAAFl33KnvNs832.jpg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>ç»„åï¼šæ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„<code>storage</code>ç»„åç§°ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸåæœ‰<code>storage</code>æœåŠ¡å™¨è¿”å›ï¼Œéœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œä¿å­˜ã€‚</li> <li>è™šæ‹Ÿç£ç›˜è·¯å¾„ï¼š<code>storage</code>é…ç½®çš„è™šæ‹Ÿè·¯å¾„ï¼Œä¸ç£ç›˜é€‰é¡¹<code>store_path*</code>å¯¹åº”ã€‚å¦‚æœé…ç½®äº†<code>store_path0</code>åˆ™æ˜¯<code>M00</code>ï¼Œå¦‚æœé…ç½®äº†<code>store_path1</code>åˆ™æ˜¯<code>M01</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li> <li>æ•°æ®ä¸¤çº§ç›®å½•ï¼š<code>storage</code>æœåŠ¡å™¨åœ¨æ¯ä¸ªè™šæ‹Ÿç£ç›˜è·¯å¾„ä¸‹åˆ›å»ºçš„ä¸¤çº§ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶</li> <li>æ–‡ä»¶åï¼šä¸æ–‡ä»¶ä¸Šä¼ æ—¶ä¸åŒã€‚æ˜¯ç”±å­˜å‚¨æœåŠ¡å™¨æ ¹æ®ç‰¹å®šä¿¡æ¯ç”Ÿæˆï¼Œæ–‡ä»¶ååŒ…å«ï¼šæºå­˜å‚¨æœåŠ¡å™¨IPåœ°å€ã€æ–‡ä»¶åˆ›
å»ºæ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€éšæœºæ•°å’Œæ–‡ä»¶æ‹“å±•åç­‰ä¿¡æ¯ã€‚</li></ul> <h4 id="_1-2-3-æ–‡ä»¶ä¸‹è½½æµç¨‹"><a href="#_1-2-3-æ–‡ä»¶ä¸‹è½½æµç¨‹" class="header-anchor">#</a> 1.2.3 æ–‡ä»¶ä¸‹è½½æµç¨‹</h4> <p>trackeræ ¹æ®è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„å³æ–‡ä»¶ID æ¥å¿«é€Ÿå®šä¹‰æ–‡ä»¶ã€‚</p> <p><img src="/image/fastdfs2.jpg" alt="fastdfsä¸‹è½½æµç¨‹"></p> <p>æ¯”å¦‚è¯·æ±‚ä¸‹è¾¹çš„æ–‡ä»¶ï¼š</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>group1/M00/00/00/wKjRgF3PPvOAOF7HAAFl33KnvNs832.jpg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>é€šè¿‡ç»„å<code>tracker</code>èƒ½å¤Ÿå¾ˆå¿«çš„å®šä½åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„å­˜å‚¨æœåŠ¡å™¨ç»„æ˜¯<code>group1</code>ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„å­˜å‚¨æœåŠ¡å™¨æä¾›å®¢æˆ·ç«¯è®¿é—®ã€‚</li> <li>å­˜å‚¨æœåŠ¡å™¨æ ¹æ®â€œæ–‡ä»¶å­˜å‚¨è™šæ‹Ÿç£ç›˜è·¯å¾„â€å’Œâ€œæ•°æ®æ–‡ä»¶ä¸¤çº§ç›®å½•â€å¯ä»¥å¾ˆå¿«å®šä½åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¹¶æ ¹æ®æ–‡ä»¶åæ‰¾åˆ°
å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æ–‡ä»¶ã€‚</li></ul> <h2 id="_2-fastdfså…¥é—¨"><a href="#_2-fastdfså…¥é—¨" class="header-anchor">#</a> 2 FastDFSå…¥é—¨</h2> <h3 id="_2-1-fastdfså®‰è£…é…ç½®-tracker"><a href="#_2-1-fastdfså®‰è£…é…ç½®-tracker" class="header-anchor">#</a> 2.1 FastDFSå®‰è£…é…ç½®(tracker)</h3> <p>æ³¨ï¼šæœ¬æ¬¡ä¹‹å®‰è£…ä¸€å°trackerã€storage,ä¸”éƒ½åœ¨åŒä¸€å°æœºå™¨ä¸Šã€æ–¹ä¾¿è°ƒè¯•ã€‚æœ‰å…´è¶£çš„å¯ä»¥æ‹“å±•æˆåˆ†å¸ƒå¼</p> <h4 id="_2-1-1-å®‰è£…æ¡ä»¶"><a href="#_2-1-1-å®‰è£…æ¡ä»¶" class="header-anchor">#</a> 2.1.1 å®‰è£…æ¡ä»¶</h4> <ul><li>éœ€è¦ä¸€å°<code>CentOS7</code>è™šæ‹Ÿæœº</li> <li>ä¸‹è½½<code>FastDFS</code>å®‰è£…åŒ…ï¼Œåœ°å€ï¼šhttps://github.com/happyfish100/FastDFS ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨<code>FastDFS_v5.05.tar.gz</code></li></ul> <h4 id="_2-1-2-å‡†å¤‡å®‰è£…ç¯å¢ƒ"><a href="#_2-1-2-å‡†å¤‡å®‰è£…ç¯å¢ƒ" class="header-anchor">#</a> 2.1.2 å‡†å¤‡å®‰è£…ç¯å¢ƒ</h4> <ul><li><p><code>FastDFS</code>æ˜¯<code>Cè¯­è¨€</code>å¼€å‘ï¼Œç¼–è¯‘ä¾èµ–<code>gcc</code>ç¯å¢ƒï¼Œå®‰è£… <code>gcc</code></p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>yum -y install gcc-c++
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ä¾èµ–ä¾èµ–<code>libevent</code>åº“</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>yum -y install libevent
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>libfastcommon</code>æ˜¯<code>FastDFS</code>å®˜æ–¹æä¾›çš„ï¼Œ<code>libfastcommon</code>åŒ…å«äº†<code>FastDFS</code>è¿è¡Œæ‰€éœ€è¦çš„ä¸€äº›åŸºç¡€åº“ã€‚æœ¬æ–‡æ¡£ä½¿ç”¨çš„æ˜¯<code>libfastcommonV1.0.7.tar.gz</code>,ä¸‹è½½åœ°å€ï¼šhttps://github.com/happyfish100/libfastcommon/releases</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># å°†libfastcommonV1.0.7.tar.gzæ‹·è´è‡³/usr/local/ä¸‹</span>
cd /usr/local
tar -zxvf libfastcommonV1.<span class="token number">0.7</span>.tar.gz
cd libfastcommon-<span class="token number">1.0.7</span>
./make.sh
./make.sh install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><strong>æ³¨æ„ï¼š<code>libfastcommon</code>å®‰è£…å¥½åä¼šè‡ªåŠ¨å°†åº“æ–‡ä»¶æ‹·è´è‡³<code>/usr/lib64</code>ä¸‹ï¼Œç”±äº<code>FastDFS</code>ç¨‹åºå¼•ç”¨<code>usr/lib</code>ç›®å½•æ‰€ä»¥éœ€è¦å°†<code>/usr/lib64</code>ä¸‹çš„åº“æ–‡ä»¶æ‹·è´è‡³/<code>usr/lib</code>ä¸‹ã€‚</strong></p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># è¿™é‡Œè¦æ ¹æ®linux 32è¿˜æ˜¯64ä½çš„å®é™…è°ƒæ•´</span>
cp /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h4 id="_2-1-3-å®‰è£…fastdfs"><a href="#_2-1-3-å®‰è£…fastdfs" class="header-anchor">#</a> 2.1.3 å®‰è£…FastDFS</h4> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># å°†FastDFS_v5.05.tar.gzæ‹·è´è‡³/usr/local/ä¸‹</span>

tar -zxvf FastDFS_v5.<span class="token number">05</span>.tar.gz

cd FastDFS

./make.sh
./make.sh install

<span class="token comment"># å®‰è£…æˆåŠŸå°†å®‰è£…ç›®å½•ä¸‹çš„confä¸‹çš„æ–‡ä»¶æ‹·è´åˆ°/etc/fdfs/ä¸‹ã€‚</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_2-1-4-é…ç½®fastdfs-tracker"><a href="#_2-1-4-é…ç½®fastdfs-tracker" class="header-anchor">#</a> 2.1.4 é…ç½®FastDFS(tracker)</h4> <p>å®‰è£…æˆåŠŸåè¿›å…¥<code>/etc/fdfs</code>ç›®å½•</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>
<span class="token comment"># æ‹·è´ä¸€ä»½æ–°çš„trackeré…ç½®æ–‡ä»¶ï¼š</span>
cp tracker.conf.sample tracker.conf

<span class="token comment"># ä¿®æ”¹tracker.conf</span>
vi tracker.conf
<span class="token comment"># base_path=/home/yuqing/FastDFS   </span>
<span class="token comment"># æ”¹ä¸ºï¼šï¼ˆæ ¹æ®ä¸ªäººå…·ä½“æƒ…å†µè°ƒæ•´ï¼‰</span>
<span class="token comment"># base_path=/home/FastDFS</span>
<span class="token comment"># é…ç½®httpç«¯å£ï¼š</span>
http.server_port=<span class="token number">80</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_2-1-5-å¯åŠ¨tracker"><a href="#_2-1-5-å¯åŠ¨tracker" class="header-anchor">#</a> 2.1.5 å¯åŠ¨Tracker</h4> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># æ³¨æ„æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯ï¼ˆæ³¨æ„å¯åŠ¨é¡ºåº-tracker-storageï¼‰</span>
/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-2-fastdfså®‰è£…é…ç½®-storage"><a href="#_2-2-fastdfså®‰è£…é…ç½®-storage" class="header-anchor">#</a> 2.2 FastDFSå®‰è£…é…ç½®(storage)</h3> <h4 id="_2-2-1-å®‰è£…è¿‡ç¨‹"><a href="#_2-2-1-å®‰è£…è¿‡ç¨‹" class="header-anchor">#</a> 2.2.1 å®‰è£…è¿‡ç¨‹</h4> <p>åŒ <code>Tracker</code></p> <h4 id="_2-2-2-é…ç½®fastdfs-storage"><a href="#_2-2-2-é…ç½®fastdfs-storage" class="header-anchor">#</a> 2.2.2 é…ç½®FastDFS(Storage)</h4> <p>å®‰è£…æˆåŠŸåè¿›å…¥<code>/etc/fdfs</code>ç›®å½•</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># æ‹·è´ä¸€ä»½æ–°çš„storageé…ç½®æ–‡ä»¶ï¼š</span>
cp storage.conf.sample storage.conf

<span class="token comment"># ä¿®æ”¹storage.conf</span>
vi storage.conf
<span class="token comment"># group_name=group1</span>
<span class="token comment"># base_path=/home/yuqing/FastDFS æ”¹ä¸ºï¼šbase_path=/home/FastDFSï¼ˆæ ¹æ®ä¸ªäººå…·ä½“æƒ…å†µè°ƒæ•´ï¼‰</span>
<span class="token comment"># store_path0=/home/yuqing/FastDFS æ”¹ä¸ºï¼šstore_path0=/home/FastDFS/fdfs_storageï¼ˆæ ¹æ®ä¸ªäººå…·ä½“æƒ…å†µè°ƒæ•´ï¼‰</span>
<span class="token comment">#å¦‚æœæœ‰å¤šä¸ªæŒ‚è½½ç£ç›˜åˆ™å®šä¹‰å¤šä¸ªstore_pathï¼Œå¦‚ä¸‹ï¼ˆæ ¹æ®ä¸ªäººå…·ä½“æƒ…å†µè°ƒæ•´ï¼‰</span>
<span class="token comment">#store_path1=.....</span>
<span class="token comment">#store_path2=......</span>
tracker_server=<span class="token number">192.168.101.3</span>:<span class="token number">22122</span>   <span class="token comment">#é…ç½®trackeræœåŠ¡å™¨:IP</span>
<span class="token comment">#å¦‚æœæœ‰å¤šä¸ªåˆ™é…ç½®å¤šä¸ªtracker</span>
tracker_server=<span class="token number">192.168.101.4</span>:<span class="token number">22122</span>

<span class="token comment">#é…ç½®httpç«¯å£</span>
http.server_port=<span class="token number">80</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_2-2-3-å¯åŠ¨storage"><a href="#_2-2-3-å¯åŠ¨storage" class="header-anchor">#</a> 2.2.3 å¯åŠ¨Storage</h4> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># æ³¨æ„æ§åˆ¶å°çš„æ‰“å°ä¿¡æ¯ï¼ˆæ³¨æ„å¯åŠ¨é¡ºåº-tracker-storageï¼‰</span>
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-3-æµ‹è¯•fastdfsæ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#_2-3-æµ‹è¯•fastdfsæ˜¯å¦å®‰è£…æˆåŠŸ" class="header-anchor">#</a> 2.3 æµ‹è¯•FastDFSæ˜¯å¦å®‰è£…æˆåŠŸ</h3> <h4 id="_2-3-1-ä¸Šä¼ å›¾ç‰‡æµ‹è¯•"><a href="#_2-3-1-ä¸Šä¼ å›¾ç‰‡æµ‹è¯•" class="header-anchor">#</a> 2.3.1 ä¸Šä¼ å›¾ç‰‡æµ‹è¯•</h4> <p><code>FastDFS</code>å®‰è£…æˆåŠŸå¯é€šè¿‡<code>/usr/bin/fdfs_test</code>æµ‹è¯•ä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œã€‚</p> <p>ä¿®æ”¹<code>/etc/fdfs/client.conf</code></p> <p><code>tracker_server</code>æ ¹æ®è‡ªå·±éƒ¨ç½²è™šæ‹Ÿæœºçš„æƒ…å†µ/é…ç½®</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># æ‹·è´ä¸€ä»½æ–°çš„clienté…ç½®æ–‡ä»¶ï¼š</span>
cp client.conf.sample client.conf

<span class="token comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
vi client.conf
<span class="token comment"># base_path=/home/fastdfs</span>
<span class="token comment"># tracker_server=192.168.101.3:22122</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä½¿ç”¨æ ¼å¼ï¼š</p> <p><code>/usr/bin/fdfs_test</code>å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ°å€  <code>upload</code> ä¸Šä¼ æ–‡ä»¶</p> <p>æ¯”å¦‚å°†<code>/home</code>ä¸‹çš„å›¾ç‰‡ä¸Šä¼ åˆ°<code>FastDFS</code>ä¸­ï¼š</p> <div class="language-cma line-numbers-mode"><pre class="language-text"><code>/usr/bin/fdfs_test /etc/fdfs/client.conf upload /home/tomcat.png
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>This is FastDFS client test program v5.<span class="token number">05</span>

<span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2008</span>, Happy Fish / YuQing

FastDFS may be copied only under the terms of the GNU General
Public License V3, which may be found in the FastDFS source kit.
Please visit the FastDFS Home Page http://www.csource.org/ 
for more detail.

[<span class="token number">2019</span>-<span class="token number">11</span>-<span class="token number">18</span> <span class="token number">22</span>:<span class="token number">56</span>:<span class="token number">28</span>] DEBUG - base_path=/home/chenyn/fastdfs/FastDFS, connect_timeout=<span class="token number">30</span>, network_timeout=<span class="token number">60</span>, tracker_server_count=<span class="token number">1</span>, anti_steal_token=<span class="token number">0</span>, anti_steal_secret_key length=<span class="token number">0</span>, use_connection_pool=<span class="token number">0</span>, g_connection_pool_max_idle_time=3600s, use_storage_id=<span class="token number">0</span>, storage server id count: <span class="token number">0</span>

tracker_query_storage_store_list_without_group: 
	server <span class="token number">1</span>. group_name=, ip_addr=<span class="token number">192.168.127.128</span>, port=<span class="token number">23000</span>

group_name=group1, ip_addr=<span class="token number">192.168.127.128</span>, port=<span class="token number">23000</span>
storage_upload_by_filename
group_name=group1, remote_filename=M00/<span class="token number">00</span>/<span class="token number">00</span>/wKh_gF3SsRyAJg6iAABlnZYG9PM641.png
source ip address: <span class="token number">192.168.127.128</span>
file timestamp=<span class="token number">2019</span>-<span class="token number">11</span>-<span class="token number">18</span> <span class="token number">22</span>:<span class="token number">56</span>:<span class="token number">28</span>
file size=<span class="token number">26013</span>
file crc32=<span class="token number">2517038323</span>
example file url: http://<span class="token number">192.168.127.128</span>/group1/M00/<span class="token number">00</span>/<span class="token number">00</span>/wKh_gF3SsRyAJg6iAABlnZYG9PM641.png
storage_upload_slave_by_filename
group_name=group1, remote_filename=M00/<span class="token number">00</span>/<span class="token number">00</span>/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png
source ip address: <span class="token number">192.168.127.128</span>
file timestamp=<span class="token number">2019</span>-<span class="token number">11</span>-<span class="token number">18</span> <span class="token number">22</span>:<span class="token number">56</span>:<span class="token number">29</span>
file size=<span class="token number">26013</span>
file crc32=<span class="token number">2517038323</span>
example file url: http://<span class="token number">192.168.127.128</span>/group1/M00/<span class="token number">00</span>/<span class="token number">00</span>/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>æ­å–œä½ æˆåŠŸäº†ğŸ™‚~</p> <h4 id="_2-3-2-ä¸‹è½½å›¾ç‰‡"><a href="#_2-3-2-ä¸‹è½½å›¾ç‰‡" class="header-anchor">#</a> 2.3.2 ä¸‹è½½å›¾ç‰‡</h4> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>http://<span class="token number">192.168.127.128</span>/group1/M00/<span class="token number">00</span>/<span class="token number">00</span>/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.png
<span class="token comment"># æ­¤è·¯å¾„å°±æ˜¯æ–‡ä»¶çš„ä¸‹è½½è·¯å¾„ å¯¹åº”storageæœåŠ¡å™¨ä¸Šçš„</span>
/home/chenyn/fastdfs/FastDFS/storage/data/<span class="token number">00</span>/<span class="token number">00</span>/wKh_gF3SsRyAJg6iAABlnZYG9PM641_big.pngæ–‡ä»¶ã€‚
<span class="token comment"># ç”±äºç°åœ¨è¿˜æ²¡æœ‰å’Œnginxæ•´åˆæ— æ³•ä½¿ç”¨httpä¸‹è½½ã€‚å¾…æ–°å¢</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_3-springbootæ•´åˆfastdfså®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æµ‹è¯•"><a href="#_3-springbootæ•´åˆfastdfså®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æµ‹è¯•" class="header-anchor">#</a> 3 SpringBootæ•´åˆFastDFSå®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æµ‹è¯•</h2> <p>ä½¿ç”¨<code>javaApi</code>æµ‹è¯•æ–‡ä»¶çš„ä¸Šä¼ ã€‚
<code>java</code>ç‰ˆæœ¬çš„<code>fastdfs-client</code>åœ°å€åœ¨ï¼šhttps://github.com/happyfish100/fastdfs-client-javaï¼Œå‚è€ƒæ­¤å·¥ç¨‹ç¼–å†™æµ‹è¯•ç”¨
ä¾‹ã€‚</p> <h3 id="_3-1-ç¯å¢ƒæ­å»º"><a href="#_3-1-ç¯å¢ƒæ­å»º" class="header-anchor">#</a> 3.1 ç¯å¢ƒæ­å»º</h3> <ul><li><p>æ–°å»ºmavenå·¥ç¨‹</p></li> <li><p>æ·»åŠ ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.9.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.itcast.javaee<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastdfs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0â€SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
 	   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/net.oschina.zcx7878/fastdfs-client-java --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.oschina.zcx7878<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastdfs-client-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.27.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>	
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div></li> <li><p>resourcesç›®å½•ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶<code>fastdfs-client.properties</code></p></li></ul> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">fastdfs.connect_timeout_in_seconds</span> <span class="token punctuation">=</span> <span class="token attr-value">5</span>
<span class="token attr-name">fastdfs.network_timeout_in_seconds</span> <span class="token punctuation">=</span> <span class="token attr-value">30</span>
<span class="token attr-name">fastdfs.charset</span> <span class="token punctuation">=</span> <span class="token attr-value">UTFâ€8</span>
<span class="token attr-name">fastdfs.http_anti_steal_token</span> <span class="token punctuation">=</span> <span class="token attr-value">false</span>
<span class="token attr-name">fastdfs.http_secret_key</span> <span class="token punctuation">=</span> <span class="token attr-value">FastDFS1234567890</span>
<span class="token attr-name">fastdfs.http_tracker_http_port</span> <span class="token punctuation">=</span> <span class="token attr-value">80</span>
<span class="token comment"># æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span>
<span class="token attr-name">fastdfs.tracker_servers</span> <span class="token punctuation">=</span> <span class="token attr-value">192.168.101.64:22122</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-2-æ–‡ä»¶ä¸Šä¼ ã€æŸ¥è¯¢ã€ä¸‹è½½"><a href="#_3-2-æ–‡ä»¶ä¸Šä¼ ã€æŸ¥è¯¢ã€ä¸‹è½½" class="header-anchor">#</a> 3.2 æ–‡ä»¶ä¸Šä¼ ã€æŸ¥è¯¢ã€ä¸‹è½½</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * æ–‡ä»¶ä¸Šä¼ 
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">fileUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;java.version=&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;java.version&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// åŠ è½½é…ç½®æ–‡ä»¶</span>
            <span class="token comment">//ClientGlobal.init(conf_filename);</span>
            <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">initByProperties</span><span class="token punctuation">(</span><span class="token string">&quot;fastdfs-client.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;network_timeout=&quot;</span> <span class="token operator">+</span> <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span>g_network_timeout <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;charset=&quot;</span> <span class="token operator">+</span> <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span>g_charset<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//åˆ›å»ºtrackerå®¢æˆ·ç«¯</span>
            <span class="token class-name">TrackerClient</span> tracker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackerClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TrackerServer</span> trackerServer <span class="token operator">=</span> tracker<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StorageServer</span> storageServer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">//å®šä¹‰ä¸€ä¸ªstorageå®¢æˆ·ç«¯</span>
            <span class="token class-name">StorageClient1</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StorageClient1</span><span class="token punctuation">(</span>trackerServer<span class="token punctuation">,</span> storageServer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//æ–‡ä»¶å…ƒä¿¡æ¯</span>
            <span class="token class-name">NameValuePair</span><span class="token punctuation">[</span><span class="token punctuation">]</span> metaList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NameValuePair</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            metaList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NameValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;fileName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C:\\Users\\hspcadmin\\Desktop\\cat.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//æ‰§è¡Œä¸Šä¼ </span>
            <span class="token class-name">String</span> fileId <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">upload_file1</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\Users\\hspcadmin\\Desktop\\cat.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">,</span> metaList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;upload success. file id is: &quot;</span> <span class="token operator">+</span> fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//å…³é—­trackeræœåŠ¡</span>
            trackerServer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æŸ¥è¯¢æ–‡ä»¶
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">queryFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;java.version=&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;java.version&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// åŠ è½½é…ç½®æ–‡ä»¶</span>
            <span class="token comment">//ClientGlobal.init(conf_filename);</span>
            <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">initByProperties</span><span class="token punctuation">(</span><span class="token string">&quot;fastdfs-client.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;network_timeout=&quot;</span> <span class="token operator">+</span> <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span>g_network_timeout <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;charset=&quot;</span> <span class="token operator">+</span> <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span>g_charset<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//åˆ›å»ºtrackerå®¢æˆ·ç«¯</span>
            <span class="token class-name">TrackerClient</span> tracker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackerClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TrackerServer</span> trackerServer <span class="token operator">=</span> tracker<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StorageServer</span> storageServer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">//å®šä¹‰ä¸€ä¸ªstorageå®¢æˆ·ç«¯</span>
            <span class="token class-name">StorageClient1</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StorageClient1</span><span class="token punctuation">(</span>trackerServer<span class="token punctuation">,</span> storageServer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//æŸ¥è¯¢æ–‡ä»¶</span>
            <span class="token class-name">FileInfo</span> fileInfo <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">query_file_info</span><span class="token punctuation">(</span><span class="token string">&quot;group1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileInfo</span> fileInfo1 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">query_file_info1</span><span class="token punctuation">(</span><span class="token string">&quot;group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileInfo1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æŸ¥è¯¢æ–‡ä»¶å…ƒä¿¡æ¯</span>
            <span class="token class-name">NameValuePair</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fileInfos <span class="token operator">=</span>  client<span class="token punctuation">.</span><span class="token function">get_metadata1</span><span class="token punctuation">(</span><span class="token string">&quot;group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileInfos<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//å…³é—­trackeræœåŠ¡</span>
            trackerServer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ–‡ä»¶ä¸‹è½½
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fileDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// åŠ è½½é…ç½®æ–‡ä»¶</span>
            <span class="token comment">//ClientGlobal.init(conf_filename);</span>
            <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span><span class="token function">initByProperties</span><span class="token punctuation">(</span><span class="token string">&quot;fastdfs-client.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;network_timeout=&quot;</span> <span class="token operator">+</span> <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span>g_network_timeout <span class="token operator">+</span> <span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;charset=&quot;</span> <span class="token operator">+</span> <span class="token class-name">ClientGlobal</span><span class="token punctuation">.</span>g_charset<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//åˆ›å»ºtrackerå®¢æˆ·ç«¯</span>
            <span class="token class-name">TrackerClient</span> tracker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrackerClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TrackerServer</span> trackerServer <span class="token operator">=</span> tracker<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StorageServer</span> storageServer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">//å®šä¹‰ä¸€ä¸ªstorageå®¢æˆ·ç«¯</span>
            <span class="token class-name">StorageClient1</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StorageClient1</span><span class="token punctuation">(</span>trackerServer<span class="token punctuation">,</span> storageServer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//ä¸‹è½½æ–‡ä»¶</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fileBytes <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">download_file1</span><span class="token punctuation">(</span><span class="token string">&quot;group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:/chenyn.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileOutputStream</span>  fileOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fileBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å…³é—­trackeræœåŠ¡</span>
            trackerServer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>1.å¦‚æœæœ‰å‘ç”Ÿsockerè¿æ¥è¶…æ—¶ï¼Œæ³¨æ„æŸ¥çœ‹linuxæœºå™¨çš„é˜²ç«å¢™æ˜¯å¦å…³é—­</p> <p>2.å¦‚æœå‘ç°ä¸Šä¼ æ–‡ä»¶ä¹‹åï¼Œæ–‡ä»¶ç›®å½•ä¸‹æœ‰-mï¼Œ-bigæ–‡ä»¶ç­‰ï¼Œè¿™äº›æ–‡ä»¶æ˜¯ä¸Šä¼ æ–‡ä»¶çš„å…ƒæ•°æ®</p></div> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># æˆ–è€…ç«¯å£æ˜¯å¦å¼€æ”¾</span>
vi /etc/sysconfig/iptables
<span class="token comment"># -A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT </span>
<span class="token comment"># æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£æ•°é‡</span>
service iptables status

<span class="token comment"># æŸ¥çœ‹å…ƒæ•°æ®æ–‡ä»¶, æ˜¯ å‚æ•°author,height,widthçš„é”®å€¼å¯¹</span>
vi test.png.m 

<span class="token comment"># å…³é—­å…ƒæ•°æ®ä¸Šä¼ </span>
<span class="token comment"># åœ¨è°ƒç”¨client.upload_file()æ—¶ï¼Œmeta_listå…¥å‚ä¼ nullå³å¯</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_4-æ–‡ä»¶æœåŠ¡æ¡ˆä¾‹"><a href="#_4-æ–‡ä»¶æœåŠ¡æ¡ˆä¾‹" class="header-anchor">#</a> 4 æ–‡ä»¶æœåŠ¡æ¡ˆä¾‹</h2> <h3 id="_4-1-éœ€æ±‚"><a href="#_4-1-éœ€æ±‚" class="header-anchor">#</a> 4.1 éœ€æ±‚</h3> <p><img src="/image/fastdfs3.jpg" alt=""></p> <ul><li><p>ä¸Šä¼ é¡µé¢ä¸Šä¼ å›¾ç‰‡åˆ°<code>fastDFS</code>æ–‡ä»¶ç³»ç»Ÿã€‚</p> <ul><li>è¿›å…¥ä¸Šä¼ é¡µé¢ï¼Œç‚¹å‡»ä¸Šä¼ å›¾ç‰‡ï¼Œé€‰æ‹©æœ¬åœ°å›¾ç‰‡</li> <li>é€‰æ‹©æœ¬åœ°å›¾ç‰‡åï¼Œè¿›è¡Œä¸Šä¼ ï¼Œå‰ç«¯æµè§ˆå™¨ä¼šé€šè¿‡<code>http</code>è°ƒç”¨æ–‡ä»¶ç®¡ç†æœåŠ¡çš„æ–‡ä»¶ä¸Šä¼ æ¥å£è¿›è¡Œä¸Šä¼ </li> <li>æ–‡ä»¶ç®¡ç†æœåŠ¡é€šè¿‡<code>socket</code>è¯·æ±‚<code>FastDFS</code>æ–‡ä»¶ç³»ç»Ÿçš„ä¸Šä¼ å›¾ç‰‡ï¼Œæœ€ç»ˆå›¾ç‰‡ä¿å­˜åœ¨<code>FastDFS</code>æ–‡ä»¶ç³»ç»Ÿä¸­çš„<code>storage server</code>ä¸­ã€‚</li></ul></li> <li><p>æµè§ˆä¸Šä¼ çš„å›¾ç‰‡</p> <ul><li><p>è¿›å…¥è§†é¢‘ä¸‹è½½é¡µé¢</p></li> <li><p>å‰ç«¯æµè§ˆå™¨é€šè¿‡å›¾ç‰‡åœ°å€è¯·æ±‚å›¾ç‰‡æœåŠ¡å™¨ä»£ç†<code>nginx</code></p></li> <li><p>å›¾ç‰‡æœåŠ¡å™¨ä»£ç†æ ¹æ®è´Ÿè½½æƒ…å†µå°†å›¾ç‰‡æµè§ˆè¯·æ±‚è½¬å‘åˆ°ä¸€å°<code>storage server</code></p></li> <li><p><code>storage server</code>æ‰¾åˆ°å›¾ç‰‡åé€šè¿‡<code>nginx</code>å°†å›¾ç‰‡å“åº”ç»™ç½‘å‹</p></li></ul></li></ul> <h3 id="_4-2-å®‰è£…-fastdfsã€nginx"><a href="#_4-2-å®‰è£…-fastdfsã€nginx" class="header-anchor">#</a> 4.2 å®‰è£… FastDFSã€Nginx</h3> <h4 id="_4-2-1-å®‰è£…fastdfs"><a href="#_4-2-1-å®‰è£…fastdfs" class="header-anchor">#</a> 4.2.1 å®‰è£…FastDFS</h4> <p>å‚ä¸Š</p> <h4 id="_4-2-2-å®‰è£…nginx"><a href="#_4-2-2-å®‰è£…nginx" class="header-anchor">#</a> 4.2.2 å®‰è£…Nginx</h4> <p>é¦–å…ˆå‚è€ƒ<a href="/dev/nginx/nginxstudy">nginxåŸºç¡€å…¥é—¨</a>ï¼Œäº†è§£å’Œæ­å»º<code>nginx</code>æœåŠ¡å™¨</p> <h4 id="_4-2-3-å®‰è£…-fastdfs-nginx-module"><a href="#_4-2-3-å®‰è£…-fastdfs-nginx-module" class="header-anchor">#</a> 4.2.3 å®‰è£… FastDFS-nginx-module</h4> <p>æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ <code>FastDFS-nginx-module_v1.16.tar.gz</code></p> <p>å‚è€ƒ<code>github</code>åœ°å€ï¼šhttps://github.com/happyfish100/fastdfs-nginx-module</p> <p><strong>æ³¨æ„ï¼šè¦å…ˆå…³é—­æ‰€æœ‰çš„<code>nginx</code>è¿›ç¨‹ï¼Œå†è¿›è¡Œä¸‹é¢çš„æ­¥éª¤</strong></p> <ul><li><p>è°ƒæ•´ <code>fastdfs-nginx-module</code>é…ç½®</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># è°ƒæ•´ mod_fastdfs.confé…ç½® </span>
<span class="token comment"># è¿›å…¥fastdfs-nginx-moduleè§£å‹ç›®å½•</span>
cd /home/chenyn/fastdfs/fastdfs-nginx-module/src
<span class="token comment"># å¤åˆ¶mod_fastdfs.confå¤åˆ¶åˆ°/etc/fdfs/é‡Œé¢</span>
cp mod_fastdfs.conf /etc/fdfs/
<span class="token comment"># è°ƒæ•´mod_fastdfs.confé…ç½®ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è·¯å¾„</span>
<span class="token comment"># æ›´æ”¹ base_path=/home/chenyn/fastdfs/FastDFS</span>
<span class="token comment"># æ›´æ”¹ tracker_server=192.168.209.128:22122</span>
<span class="token comment"># æ›´æ”¹ store_path0=/home/chenyn/fastdfs/FastDFS/storage</span>

<span class="token comment"># è°ƒæ•´fastdfs-nginx-moduleçš„configæ–‡ä»¶ </span>
 vi  config 
<span class="token comment">#ï¼ˆè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¾ˆé‡è¦ï¼Œå¾ˆé‡è¦ï¼ˆé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼‰ </span>
<span class="token comment"># CORE_INCS=&quot;$CORE_INCS /usr/local/include/fastdfs /usr/local/include/fastcommon/&quot; --åˆ é™¤local</span>
<span class="token comment"># CORE_LIBS=&quot;$CORE_LIBS -L/usr/local/lib -lfastcommon -lfdfsclient&quot; --åˆ é™¤local</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>é‡æ–°ç¼–è¯‘nginx</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># è¿›å…¥è§£å‹çš„nginxç›®å½•ï¼ˆæ ¹æ®ä¸ªäººæƒ…å†µè°ƒæ•´ç›®å½•ç»“æ„ï¼‰</span>
cd /home/chenyn/nginx/nginx-<span class="token number">1.17.5</span>

<span class="token comment"># é…ç½®FastDFS-nginx-module åˆ°nginxä¸­</span>
<span class="token comment"># åˆ›å»ºä¸´æ—¶ç›®å½• </span>
mkdir -p /var/temp/nginx 
<span class="token comment"># ç”¨ä¸‹é¢çš„å‘½ä»¤</span>
./configure \
    --add-module=/home/chenyn/fastdfs/fastdfs-nginx-module/src
<span class="token comment"># (/home/chenyn/fastdfs/fastdfs-nginx-module/srcæ ¹æ®è‡ªå·±çš„æ–‡ä»¶ç›®å½•æ¥é…)</span>

<span class="token comment"># é‡æ–°ç¼–è¯‘</span>
make
make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul> <h4 id="_4-2-4-é…ç½®nginx"><a href="#_4-2-4-é…ç½®nginx" class="header-anchor">#</a> 4.2.4 é…ç½®nginx</h4> <ul><li><p>åªæœ‰ä¸€ä¸ª<code>group</code>æ—¶ï¼Œæœ€ç®€å•çš„é…ç½®ï¼šå½“<code>mod_fastdfs.conf</code> é…ç½®æ–‡ä»¶ä¸­åªæœ‰ä¸€ä¸ª<code>group1</code>, ä¸”é…ç½®äº†<code>url_have_group_name = false</code>æ—¶ï¼Œå³è®¿é—®åœ°å€ä¸ä½¿ç”¨åˆ†ç»„åç§°ï¼Œé‚£ä¹ˆåªéœ€åœ¨<code>nginx</code>çš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹é…ç½®å³å¯:ï¼ˆä¸æ¨èï¼‰</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># è¿›å…¥nginxé…ç½®ç›®å½•</span>
cd /usr/local/nginx/conf

<span class="token comment">#åœ¨nginx.confé‡Œé¢çš„server{é‡Œé¢æ·»åŠ location /M00â€¦â€¦}ï¼Œæ·»åŠ ä¸‹é¢çš„å‡ è¡Œï¼š</span>
location /M00 {
      root /home/chenyn/fastdfs/FastDFS/storage/data;
          ngx_fastdfs_module;
<span class="token punctuation">}</span>

<span class="token comment">#é…ç½®è´Ÿè½½å‡è¡¡</span>
<span class="token comment">#storageç¾¤group1ç»„</span>
upstream storage_server_group1{
    	server <span class="token number">192.168.101.5</span>:<span class="token number">80</span> weight=<span class="token number">10</span>;
		server <span class="token number">192.168.101.6</span>:<span class="token number">80</span> weight=<span class="token number">10</span>;
    <span class="token punctuation">}</span>
<span class="token comment">#storageç¾¤group2ç»„</span>
upstream storage_server_group2{
    	server <span class="token number">192.168.101.7</span>:<span class="token number">80</span> weight=<span class="token number">10</span>;
		server <span class="token number">192.168.101.8</span>:<span class="token number">80</span> weight=<span class="token number">10</span>;
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>å¤šä¸ª<code>group</code>é…ç½®ï¼Œå½“é…ç½®å¤šä¸ªç»„ï¼Œä¸”<code>mod_fastdfs.conf</code>é‡Œé¢æŒ‡å®šäº†<code>url_have_group_name= true</code> æ—¶ï¼Œé…ç½®æ–¹å¼:ï¼ˆå»ºè®®å³ä½¿ç”¨çš„æ˜¯å•ä¸ª<code>group</code>ï¼Œä¹ŸæŒ‰è¯¥æ–¹æ³•é…ç½®ï¼‰</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code> location ~  /<span class="token function">group</span><span class="token punctuation">(</span>[<span class="token number">0</span>-<span class="token number">9</span>]<span class="token punctuation">)</span> /M00 {
        root /home/chenyn/fastdfs/FastDFS/storage/data;
        ngx_fastdfs_module;
  <span class="token punctuation">}</span>
  <span class="token comment"># æ¯”å¦‚:åœ¨group1ä¸Šçš„ nginx çš„nginx.conf é…ç½®æ˜¯</span>
  location  /group1/M00 {
        root /home/chenyn/fastdfs/FastDFS/storage/data;
        ngx_fastdfs_module;
  <span class="token punctuation">}</span>
  <span class="token comment"># æ¯”å¦‚:åœ¨group2ä¸Šçš„ nginx çš„nginx.conf é…ç½®æ˜¯</span>
  location   /group2/M00 {
        root /home/chenyn/fastdfs/FastDFS/storage/data;
        ngx_fastdfs_module;
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>åˆ›å»ºè½¯è¿æ¥</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># æ ¹æ®å®é™…å­˜å‚¨ä½ç½®è°ƒæ•´è·¯å¾„</span>
<span class="token comment"># åˆ›å»ºè½¯è¿æ¥çš„ç›®çš„æ˜¯ä¸ºäº†å°†M00è™šæ‹Ÿè·¯å¾„è½¬åŒ–ä¸€ä¸‹</span>
ln -s /home/chenyn/fastdfs/FastDFS/storage/data /home/chenyn/fastdfs/FastDFS/storage/data/M00
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>è°ƒæ•´<code>FastDFS</code>é…ç½®</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># è¿›å…¥ FastDFSè§£å‹ç›®å½•</span>
cd /home/chenyn/fastdfs/FastDFS/conf
<span class="token comment"># ç§»åŠ¨é…ç½®æ–‡ä»¶</span>
cp  http.conf   /etc/fdfs/
cp  mime.types  /etc/fdfs/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>å¯åŠ¨<code>FastDFS</code>ã€<code>nginx</code></p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>
<span class="token comment"># å¯åŠ¨Tracker</span>
/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart

<span class="token comment"># å¯åŠ¨Storage</span>
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart

<span class="token comment"># å¯åŠ¨nginx</span>
cd /usr/local/nginx/sbin
./nginx -s restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul> <h3 id="_4-3-é€šè¿‡httpè®¿é—®fastdfså›¾ç‰‡"><a href="#_4-3-é€šè¿‡httpè®¿é—®fastdfså›¾ç‰‡" class="header-anchor">#</a> 4.3 é€šè¿‡<code>HTTP</code>è®¿é—®<code>FastDFS</code>å›¾ç‰‡</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>http://192.168.209.128/group1/M00/00/00/wKjRgF3PSxiAHuHtAAFl33KnvNs253.jpg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœå¯ä»¥æ­£å¸¸æŸ¥çœ‹æˆ–è€…ä¸‹è½½ï¼Œæ­å–œé…ç½®æˆåŠŸğŸ˜™</p> <p>å¦‚æœå¤±è´¥ï¼Œå¯ä»¥ä»”ç»†æŸ¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„å‘½ä»¤å’Œé…ç½®ï¼Œæ³¨æ„å‘½ä»¤å°½é‡ä¸è¦å¤åˆ¶ï¼Œå¯èƒ½ä¼šæœ‰é—®é¢˜â˜ºï¸</p> <h3 id="_4-4-å®‰è£…-fastdhtå®ç°æ–‡ä»¶å»é‡å¤„ç†"><a href="#_4-4-å®‰è£…-fastdhtå®ç°æ–‡ä»¶å»é‡å¤„ç†" class="header-anchor">#</a> 4.4 å®‰è£… <code>FastDHT</code>å®ç°æ–‡ä»¶å»é‡å¤„ç†</h3> <p><code>FastDHT</code>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å“ˆå¸Œç³»ç»Ÿï¼Œå®ƒæ˜¯åŸºäºé”®å€¼å¯¹å­˜å‚¨çš„ï¼Œè€Œä¸”å®ƒéœ€è¦ä¾èµ–äº<code>Berkeley DB</code>ä½œä¸ºæ•°æ®å­˜å‚¨çš„åª’ä»‹ï¼ŒåŒæ—¶éœ€è¦ä¾èµ–äº<code>libfastcommon</code>ã€‚</p> <p><code>FastDHT</code>é›†ç¾¤ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªç»„<code>group</code>ç»„æˆï¼ŒåŒç»„æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œæ•°æ®åŒæ­¥åªåœ¨ç»„çš„æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œï¼›ç»„å†…å„ä¸ªæœåŠ¡æ˜¯å¯¹ç­‰çš„ï¼Œå¯¹æ•°æ®è¿›è¡Œå­˜å–æ—¶ï¼Œå¯ä»¥æ ¹æ® <code>key</code>çš„<code>hash</code>å€¼æ¥å†³å®šä½¿ç”¨å“ªå°æœºå™¨ã€‚</p> <h4 id="_4-4-1-å®‰è£…berkeley-db"><a href="#_4-4-1-å®‰è£…berkeley-db" class="header-anchor">#</a> 4.4.1 å®‰è£…<code>Berkeley DB</code></h4> <p>åœ¨å®‰è£…<code>FastDHT</code>ä¹‹å‰ï¼Œéœ€è¦é¦–å…ˆå®‰è£…<code>Berkeley DB</code>ï¼Œä¹Ÿéœ€è¦å®‰è£…<code>libfastcommon</code>ï¼Œä¸è¿‡è¿™å®‰è£…<code>FastDFS</code>æ—¶å·²ç»å®‰è£…äº†<code>libfastcommon</code>ï¼Œæ‰€ä»¥è¿™é‡Œçœç•¥ã€‚</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment"># ä¸‹è½½ berkeley-db</span>
cd /home/chenyn/fastdfs
wget http://download.oracle.com/berkeley-db/db-<span class="token number">4.7.25</span>.tar.gz
<span class="token comment"># è§£å‹</span>
tar -zxvf db-<span class="token number">4.7.25</span>.tar.gz
<span class="token comment"># è¿›å…¥è§£å‹ç›®å½•</span>
cd db-<span class="token number">4.7.25</span>/build_unix
<span class="token comment"># éªŒè¯å®‰è£…ç¯å¢ƒï¼ˆå®‰è£…åˆ°äº†/usrç›®å½•ä¸‹ï¼‰</span>
sudo ../dist/configure --prefix=/usr
<span class="token comment"># ç¼–è¯‘ï¼Œä»Makefileä¸­è¯»å–æŒ‡ä»¤ï¼Œç„¶åç¼–è¯‘</span>
sudo make
<span class="token comment"># å®‰è£…ï¼Œä»Makefileä¸­è¯»å–æŒ‡ä»¤ï¼Œå®‰è£…åˆ°æŒ‡å®šä½ç½®</span>
sudo make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-4-2-å®‰è£…fastdht"><a href="#_4-4-2-å®‰è£…fastdht" class="header-anchor">#</a> 4.4.2 å®‰è£…FastDHT</h4> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>cd /home/chenyn/fastdfs
<span class="token comment"># wgetä¸‹è½½FastDHTå®‰è£…åŒ… ï¼ˆå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ç‰ˆæœ¬ï¼‰</span>
wget http://sourceforge.net/projects/fastdht/files/FastDHT%20server%20and%20php%20ext/FastDHT%20Server%20Source%20Code%20V2.<span class="token number">01</span>/FastDHT_v2.<span class="token number">01</span>.tar.gz
<span class="token comment"># è§£å‹</span>
tar â€“zxvf FastDHT_v2.<span class="token number">01</span>.tar.gz
cd FastDHT
<span class="token comment"># ç¼–è¯‘ä¹‹å‰éœ€è¦ä¿®æ”¹make.sh</span>
vi make.sh
<span class="token comment"># æ–‡ä»¶ä¸­çš„ â€œCFLAGS='-Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE'â€ ä¿®æ”¹ä¸º â€œCFLAGS='-Wall -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -I/usr/include/ -L/usr/lib/'â€ ï¼ˆ-I/usr/include/ -L/usr/lib/ï¼‰è¿™é‡Œå¯¹åº”ä¸Šé¢Berkeleyçš„å®‰è£…ç›®å½•</span>
sudo ./make.sh
sudo ./make.sh install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4-4-3-é…ç½®fastdht"><a href="#_4-4-3-é…ç½®fastdht" class="header-anchor">#</a> 4.4.3 é…ç½®FastDHT</h4> <p>å…ˆç¡®è®¤ç›®å½•<code>/data/fastdht/</code>å·²åˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç›®å½•ï¼š</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>mkdir -p /data/fastdht
<span class="token comment"># é…ç½®fdht_client.confæ–‡ä»¶</span>
cd /etc/fdht
vi fdht_client.conf
<span class="token comment"># ä¿®æ”¹ä¸‹é¢é…ç½®</span>
base_path=/data/fastdht
keep_alive=<span class="token number">1</span>
<span class="token comment">#include /etc/fdht/fdht_servers.conf   ---è¯¥é…ç½®ä¸æ˜¯æ³¨é‡Šï¼Œä¸€å®šè¦åŠ !!!</span>

<span class="token comment"># é…ç½®fdht_servers.conf</span>
vi fdht_servers.conf
<span class="token comment"># æ ¹æ®fdhtçš„æœºå™¨æ•°é‡è°ƒæ•´ï¼Œä¸‹é¢ä¸º1å°å‚è€ƒé…ç½®</span>
group_count=<span class="token number">1</span>
group0=<span class="token number">192.168.209.128</span>;<span class="token number">11411</span>

<span class="token comment"># é…ç½®fdhtd.conf</span>
vi fdhtd.conf
port=<span class="token number">11411</span>
bash_path=/data/fastdht
cache_size=32MB
<span class="token comment">#include /etc/fdht/fdht_servers.conf ---è¯¥é…ç½®ä¸æ˜¯æ³¨é‡Šï¼Œä¸€å®šè¦åŠ !!!</span>

<span class="token comment"># é…ç½®fastdfsçš„storage.conf</span>
vi /etc/fdfs/storage.conf
<span class="token comment"># æ˜¯å¦æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™å»ºç«‹ä¸€ä¸ªç´¢å¼•é“¾æ¥ä»¥èŠ‚çœç©ºé—´</span>
check_file_duplicate=<span class="token number">1</span>
<span class="token comment"># check_file_duplicate=1æ—¶ï¼ŒFastDHTçš„å‘½åç©ºé—´</span>
key_namespace=FastDFS
<span class="token comment"># é•¿è¿æ¥é…ç½®é€‰é¡¹ï¼Œ0ä¸ºçŸ­è¿æ¥ 1ä¸ºé•¿è¿æ¥</span>
keep_alive=<span class="token number">1</span>
<span class="token comment">#include /etc/fdht/fdht_servers.conf ---è¯¥é…ç½®ä¸æ˜¯æ³¨é‡Šï¼Œä¸€å®šè¦åŠ !!!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_4-4-4-å¯åŠ¨fastdht"><a href="#_4-4-4-å¯åŠ¨fastdht" class="header-anchor">#</a> 4.4.4 å¯åŠ¨<code>FastDHT</code></h4> <p>å¯åŠ¨å‰å…³é—­é˜²ç«å¢™ï¼Œæˆ–è€…å¼€å¯ç«¯å£ï¼ˆ11411ï¼‰</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code>vi /etc/sysconfig/iptables
æ·»åŠ å¦‚ä¸‹ç«¯å£è¡Œï¼š
<span class="token comment"># FastDHT Port</span>
-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="token number">11411</span> -j ACCEPT
<span class="token comment"># ä¿®æ”¹ä¹‹åé‡å¯é˜²ç«å¢™ï¼š</span>
 service iptables restart
<span class="token comment"># ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥å¯åŠ¨FastDHTäº†ã€‚</span>
 /usr/local/bin/fdhtd /etc/fdht/fdhtd.conf
<span class="token comment"># å¯ä»¥ç›‘æ§11411ç«¯å£å·çš„ä½¿ç”¨æƒ…å†µï¼Œç¡®è®¤æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚</span>
 netstat â€“unltp | grep <span class="token number">11411</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_4-4-5-ä¸Šä¼ æµ‹è¯•"><a href="#_4-4-5-ä¸Šä¼ æµ‹è¯•" class="header-anchor">#</a> 4.4.5 ä¸Šä¼ æµ‹è¯•</h4> <p>ä½¿ç”¨<code>3.2èŠ‚</code>çš„ä¸Šä¼ æ–¹æ³•ä¸Šä¼ é‡å¤æ–‡ä»¶ï¼Œè¿›å…¥<code>/M00/00/00</code> æŸ¥çœ‹</p> <p><img src="/image/fdht.jpg" alt=""></p> <p>å‡ºç°ä¸Šå›¾ï¼Œè½¯è¿æ¥æŒ‡å‘ï¼Œæ­å–œ~~ğŸ˜ƒ</p> <h3 id="_4-5-å¸¸è§é”™è¯¯"><a href="#_4-5-å¸¸è§é”™è¯¯" class="header-anchor">#</a> 4.5 å¸¸è§é”™è¯¯</h3> <ul><li><p>é…ç½®<code>FastDFS-nginx-moudle</code>å‘ç”Ÿ<code>nginx</code>è®¿é—®ä¸äº†çš„æƒ…å†µï¼ŒæŸ¥çœ‹<code>nginx</code>å¯åŠ¨æ—¥å¿—ï¼ŒæŒ‰é”™è¯¯ä¿¡æ¯æ’æŸ¥</p> <div class="language-cmake line-numbers-mode"><pre class="language-cmake"><code><span class="token comment">#Nginx æœåŠ¡å™¨å¯åŠ¨å¤±è´¥çš„ï¼Œé”™è¯¯ä¿¡æ¯ï¼štrunk_shared.c, line: 177, &quot;Permission denied&quot; can't be accessed</span>
åªéœ€ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶ï¼Œè¾“å…¥å‘½ä»¤ â€œ vi /usr/local/nginx/conf/nginx.conf â€,åœ¨é…ç½®æ–‡ä»¶çš„å¼€å¤´åŠ å…¥ â€œ user root; â€ å³å¯

<span class="token comment"># nginxæ—¥å¿—æŠ¥é”™ERROR - file: ../common/fdfs_global.c, line: 52, the format of filename</span>
vi /etc/fdfs/mod_fastdfs.conf
å°†  url_have_group_name=false æ”¹ä¸º url_have_group_name=true

<span class="token comment"># å…¶ä»–å¸¸è§é—®é¢˜,æˆ–è€…æ ¹æ®æ—¥å¿—é”™è¯¯ä¿¡æ¯æ‰¾ç™¾åº¦</span>
http://www.mamicode.com/info-detail-<span class="token number">1992668</span>.html

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul> <h1 id="å¯åŠ¨fdhtæŠ¥é”™ï¼šerror-while-loading-shared-libraries-xxx-so-0-cannot-open-shared-object-file-no-such-file-or-directory"><a href="#å¯åŠ¨fdhtæŠ¥é”™ï¼šerror-while-loading-shared-libraries-xxx-so-0-cannot-open-shared-object-file-no-such-file-or-directory" class="header-anchor">#</a> å¯åŠ¨fdhtæŠ¥é”™ï¼šerror while loading shared libraries: xxx.so.0:cannot open shared object file: No such file or directory</h1> <p>å‡ºç°è¿™ç±»é”™è¯¯è¡¨ç¤ºï¼Œç³»ç»Ÿä¸çŸ¥é“xxx.soæ”¾åœ¨å“ªä¸ªç›®å½•ä¸‹ï¼Œè¿™æ—¶å€™å°±è¦åœ¨/etc/ld.so.confä¸­åŠ å…¥xxx.soæ‰€åœ¨çš„ç›®å½•ã€‚
ä¸€èˆ¬è€Œè¨€ï¼Œæœ‰å¾ˆå¤šçš„soä¼šå­˜æ”¾åœ¨/usr/local/libè¿™ä¸ªç›®å½•åº•ä¸‹ï¼Œå»è¿™ä¸ªç›®å½•åº•ä¸‹æ‰¾ï¼Œæœç„¶å‘ç°è‡ªå·±æ‰€éœ€è¦çš„.soæ–‡ä»¶ã€‚
æ‰€ä»¥ï¼Œåœ¨/etc/ld.so.confä¸­åŠ å…¥/usr/local/libè¿™ä¸€è¡Œï¼Œä¿å­˜ä¹‹åï¼Œå†è¿è¡Œï¼š/sbin/ldconfig â€“v æ›´æ–°ä¸€ä¸‹é…ç½®å³å¯ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/28/2020, 7:36:36 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/master/01.dev/11.nginx/nginxstudy.html" class="prev">
        nginx(ä»£ç†æœåŠ¡å™¨)
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/master/assets/js/app.2082b23a.js" defer></script><script src="/master/assets/js/2.926fc16b.js" defer></script><script src="/master/assets/js/6.5babb80d.js" defer></script>
  </body>
</html>
